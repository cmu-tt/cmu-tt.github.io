(function(){var e={2745:function(e,t,o){"use strict";function s(e){try{const t=e.match(/^([\P{L}\p{Extended_Pictographic}]|(?:[\uD800-\uDBFF][\uDC00-\uDFFF]))/u);return t?t[0]:null}catch(t){return null}}function a(){if(0==arguments.length)return;let e=Array.from(arguments),t=["%cMVTT","background:#272727;color:#C9B092;padding:7px 12px;font-family:Lato,sans-serif;font-weight:bold;font-size:1.3em"];null!=s(e[0])&&(t[0]+=" %c"+s(e[0]),t[2]="background:#C9B092aa;background:#ffffffaa;color:#272727;padding:3px 5px;margin-left:5px;border-radius:5px;font-family:monospace !important;font-weight:bold;font-size:1.25em",e[0]=e[0].substring(2).trimStart());try{console[this](...t,...e)}catch(o){console.log("⚠ Couldn't override console.log",o),console.log(...t,...e)}}o.d(t,{HU:function(){return n},i2:function(){return r}});let i="info";const r={print:a.bind(i),log:a.bind("log"),info:a.bind("info"),debug:a.bind("debug"),warn:a.bind("warn"),error:a.bind("error"),_getTone:()=>i,_setTone:e=>{i=e},_resetTone:()=>{i="info"}};a.bind("info");try{window._status=r,r.log("🔧 Initialized logger")}catch(l){r.log("⚠ Couldn't set window._status",l)}function n(e){return"string"!=typeof e?e:new Date(e.replace(/-/g,"/"))}},343:function(e,t,o){"use strict";o(7658);var s=o(9242),a=o(3396),i=o(1020),r=o(7139);const n=e=>((0,a.dD)("data-v-01c17384"),e=e(),(0,a.Cn)(),e),l=["_theme"],c={class:"pause_modal router_center_view",ref:"pause_modal"},d=n((()=>(0,a._)("header",{class:"modal_header"},[(0,a._)("h2",{class:"header_style modal_header_title"},"Session paused")],-1))),u={ref:"pause_contents",class:"overlay_contents"},h=n((()=>(0,a._)("div",{class:"overlay_contents_text"}," Your session was inactive for an extended period of time and has been paused to conserve resources. ",-1))),m=n((()=>(0,a._)("br",null,null,-1))),_=n((()=>(0,a._)("div",{class:"overlay_contents_text"}," You can hide this message using the toggle in your account preferences. ",-1))),p=n((()=>(0,a._)("br",null,null,-1))),f={class:"overlay_contents_text"};function g(e,t,o,s,i,n){const g=(0,a.up)("OverlayWrapper"),k=(0,a.up)("LogoutModal"),w=(0,a.up)("ShortcutsModal"),y=(0,a.up)("TutorialBlurb"),v=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)("main",{id:"themed_body",class:(0,r.C_)(["parent",{simplified:e.$store.simplified}]),ref:"app",_theme:n.theme,onClick:t[5]||(t[5]=(...e)=>n.refreshTimeout&&n.refreshTimeout(...e)),onKeydown:t[6]||(t[6]=(...e)=>n.refreshTimeout&&n.refreshTimeout(...e)),onFocus:t[7]||(t[7]=(...e)=>n.refreshTimeout&&n.refreshTimeout(...e))},[n.do_timeout&&(e.$store.paused||i.animating)?((0,a.wg)(),(0,a.j4)(g,{key:0,ref:"overlay",class:"pause_modal_overlay",style:{"z-index":"104"}},{default:(0,a.w5)((()=>[(0,a._)("main",c,[d,(0,a._)("div",u,[h,m,_,p,(0,a._)("div",f," Please click anywhere to resume using "+(0,r.zw)(e.$env.VUE_APP_BRAND_SHORT_NAME)+". ",1)],512)],512)])),_:1},512)):(0,a.kq)("",!0),e.$store.logout_prompt?((0,a.wg)(),(0,a.j4)(g,{key:1,ref:"logout_modal",onClose:t[0]||(t[0]=t=>e.$store.logout_prompt=!1),style:{"z-index":"103"}},{default:(0,a.w5)((e=>[(0,a.Wm)(k,{class:"router_center_view",onClose:e.close},null,8,["onClose"])])),_:1},512)):(0,a.kq)("",!0),i.show_shortcuts||i.animating_shortcuts?((0,a.wg)(),(0,a.j4)(g,{key:2,ref:"shortcuts_overlay",onClose:t[1]||(t[1]=e=>i.show_shortcuts=!1),style:{"z-index":"102"}},{default:(0,a.w5)((e=>[(0,a.Wm)(w,{class:"router_center_view",ref:"shortcuts_modal",onClose:e.close},null,8,["onClose"])])),_:1},512)):(0,a.kq)("",!0),n.show_tutorial?((0,a.wg)(),(0,a.j4)(y,{title:n.tutorial.title,key:"tutorial",options:n.tutorial.options,html:n.tutorial.html||"<i style=text-align:center;width:100%;display:block>Not much to see here!</i>",button_text:n.tutorial.next_text,skip_text:n.tutorial.prev_text,trackel:n.tutorial.el,onNext:t[2]||(t[2]=e=>n.tutorial_nav(1)),onSkip:t[3]||(t[3]=e=>n.tutorial_nav(-1)),onVnodeUnmounted:t[4]||(t[4]=e=>i.tutorial_page=0),style:{"z-index":"101"}},null,8,["title","options","html","button_text","skip_text","trackel"])):(0,a.kq)("",!0),(0,a.Wm)(v)],42,l)}var k=o(3917);function w(e,t,o,s,i,r){const n=(0,a.up)("Modal");return(0,a.wg)(),(0,a.j4)(n,{class:"logout_modal",can_continue:!0,title:"Log Out",html:i.html,continue_action:r.logout,skippable:!0,onSkip:t[0]||(t[0]=t=>e.$emit("close")),skip_text:"Cancel",submit_text:"Confirm"},null,8,["html","continue_action"])}var y=o(4884),v={name:"LogoutModal",emits:["close"],components:{Modal:y.Z},data(){return{html:'<div class="overlay_contents_text">Are you sure you want to log out?<br><br>You may lose access to what you were working on, and unsaved changes may be discarded.</div>'}},methods:{logout(){this.$store.logout(),this.$emit("close")}},mounted(){setTimeout((()=>{this.$emit("close")}),1e4)}},b=o(89);const x=(0,b.Z)(v,[["render",w]]);var P=x;const T={class:"overlay_contents shortcuts_contents"},A={key:0},C={key:1,class:"shortcuts_sections"},$={class:"shortcuts_section__title"},O={class:"shortcuts_table"},S={class:"shortcut__key"},N={class:"shortcut__description"},D={key:0,class:"shortcuts_section__filler"};function j(e,t,o,s,i,n){return(0,a.wg)(),(0,a.iD)("div",{class:(0,r.C_)(["shortcuts_modal",{empty:!n.sections.length}]),ref:"shortcuts_modal"},[(0,a._)("div",T,[n.sections&&n.sections.length?((0,a.wg)(),(0,a.iD)("div",C,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.sections,(e=>((0,a.wg)(),(0,a.iD)("div",{class:"shortcuts_section",key:e.tag},[(0,a._)("p",$,(0,r.zw)(e.tag||"Other"),1),(0,a._)("table",O,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.list,(e=>((0,a.wg)(),(0,a.iD)("tr",{class:"shortcuts_table_shortcut",key:e.name,tabindex:"1"},[(0,a._)("td",S,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.keys,(e=>((0,a.wg)(),(0,a.iD)("span",{class:"button_pointer_text",key:e},(0,r.zw)(e),1)))),128))]),(0,a._)("td",N,(0,r.zw)(e.description),1)])))),128))])])))),128)),n.sections.length&&n.sections.length%2?((0,a.wg)(),(0,a.iD)("div",D)):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("div",A,"No Registered Shortcuts"))]),(0,a._)("div",{class:"click_escape nopad",onClick:t[0]||(t[0]=t=>e.$emit("close"))})],2)}var q={name:"ShortcutsModal",computed:{sections(){return this.$shortcuts.sections}},mounted(){this.$refs.shortcuts_modal.focus()},beforeUnmount(){}};const E=(0,b.Z)(q,[["render",j],["__scopeId","data-v-1ab3b320"]]);var M=E,U=o(7387),I=o.n(U),L=o(1708),R=JSON.parse('[{"el":".portal_info","title":"Let\'s get started!","html":"At the top of the portal, you\'ll find some common info, like the date, who you\'re signed in as, and what type of account you have. <br><br> You can click \'Next,\' or use space / enter / the arrow keys to continue.","options":{"reclick":".calendar, .study .action_icon.cal-icon, #portal_mobile__block","pagename":"portal"}},{"el":".calendar","title":"The Calendar","html":"The calendar shows you all of your upcoming tasks, which you can click to expand. <br><br> If you\'re a teacher, your calendar will include extra features, and will allow you to drag and drop classes to create new tasks.","options":{"radius":"25px","pagename":"portal"}},{"el":".calendar_header","title":"Calendar Controls","html":"The bar at the top of the calendar allows you to change the view, and navigate to different dates. <br><br> Let\'s take a look what it can do!","options":{"radius":"15px","pagename":"portal"}},{"el":".calendar .portal_main_block_actions","title":"Calendar Pages","html":"These buttons allow you to navigate between pages of the calendar. You\'ll be able to click the center one to return to today\'s date.","options":{"radius":"15px","pagename":"portal"}},{"el":".calendar .portal_main_block_action_alt","title":"Portal Pages","html":"This button lets you switch between the calendar and the task list. <br><br> You might see a yellow-hued dot here, indicating that you have unfinished tasks coming up soon!","options":{"radius":"15px","click_on_complete":true}},{"disable_prev":true,"el":".study","title":"Study Page","html":"On the study page, you can see a list of your upcoming tasks, mark them as complete, and add new tasks. <br><br> If you\'re a teacher, this page won\'t be as useful to you.","options":{"radius":"25px"}},{"el":".study_header","title":"Study Controls","html":"The bar at the top of the study page allows you to customize your study session. <br><br> Let\'s take a look what it can do!","options":{"radius":"15px","pagename":"study"}},{"el":".study .portal_main_block_actions","title":"Study Timeframes","html":"These buttons allow you to change the timeframe of the study page. By default, it\'ll be set to the \'Week\' view, but you can also select \'Day,\' \'Month,\' or \'All.\' <br><br> Hint: hover over the buttons to see their keyboard shortcuts!","options":{"radius":"15px","click_on_complete":".portal_main_block_actions_wrapper > nav > button:last-child","pagename":"study"}},{"el":".study .portal_main_block_action_alt","title":"Portal Pages","html":"This button lets you switch between the calendar and the task list. <br><br> You might see a yellow-hued dot here, indicating that you have unfinished tasks coming up soon!","options":{"radius":"15px","click_on_complete":".study .portal_main_block_action_alt, .right-bar","pagename":"study"}},{"disable_prev":true,"el":".right-bar","title":"Right Sidebar","html":"The right sidebar shows you some quick info about your upcoming tasks, as well as access to more materials and account switching. <br><br> On smaller screens, you can open the sidebar by hovering at the side of the display and clicking the protruding section, or on mobile tapping the arrows in the bottom nav bar.","options":{"radius":"25px 0 0 25px","padding":0,"reclick":".right-bar, #portal_mobile__right","pagename":"portal"}},{"el":".right-bar .auth-action.can-logout","title":"Logout Button","html":"Click here to logout of your account. <br><br> If you\'re having issues with your portal, logging in and out can sometimes help.","options":{"reclick":".right-bar, #portal_mobile__right","pagename":"portal"}},{"el":".right-bar .upcoming_tasks","title":"Upcoming Tasks","html":"This section shows you your upcoming tasks, which you can click to expand. <br><br> It\'ll only show up to 6 tasks, sorted by soonest due date.","options":{"reclick":".right-bar, #portal_mobile__right","pagename":"portal"}},{"el":".right-bar .settings_button","title":"Account Preferences","html":"You can click here to change your account preferences, like toggling teacher mode, adding linked accounts, disabling the session timeout, switching themes, and viewing your survey statistics! <br><br> Next, let\'s take a look at the other sidebar","options":{"reclick":".right-bar, #portal_mobile__right","click_on_complete":".left-bar, #portal_mobile__left","radius":"17px","padding":5,"pagename":"portal"}},{"disable_prev":true,"el":".left-bar","title":"Left Sidebar","html":"The left sidebar gives you access to your tasks, classes, and other materials. <br><br> If you\'re a teacher, you\'ll find your controls to create classes and tasks here.","options":{"radius":"0 25px 25px 0","padding":0,"pagename":"portal","reclick":".left-bar, #portal_mobile__left"}},{"el":".left-bar .branding-title","title":"Well, we *are* MVTT","html":"Clicking the MVTT logo will take you back to the portal home page","options":{"reclick":".left-bar, #portal_mobile__left","pagename":"portal"}},{"el":".left-bar .class_list","title":"Class List","html":"Once you\'ve joined some classes, you\'ll see them listed here. <br><br> Clicking on a class will filter your calendar and study pages to only show tasks from filtered (clicked) classes.","options":{"reclick":".left-bar, #portal_mobile__left","pagename":"portal"}},{"el":".left-bar .class_list .classes_container_class__add_class","title":"Adding Classes","html":"Click here to add a class to your account. <br><br> You can join with a class code provided by your teacher, or by entering their email and selecting from a dropdown of all their classes.","options":{"reclick":".left-bar, #portal_mobile__left","padding":5,"radius":"10px","pagename":"portal"}},{"el":".left-bar .theme_button","title":"Theme Toggle","html":"It doesn\'t all have to be work! <br><br> Click here to switch between the light and dark modes. This\'ll sync across your devices!","options":{"reclick":".left-bar, #portal_mobile__left","radius":"17px","padding":5,"pagename":"portal","click_on_complete":"#portal_mobile__block"}},{"el":null,"title":"That\'s all for now!","html":"Thanks for taking the tour! <br><br> If you have any questions, feel free to reach out to us by visiting the contact page (try using the title in the left sidebar to get to it from the homepage)! <br><br> In the meantime though, let\'s get you some more resources, then add your first class!","options":{"next_text":"Finish","reclick":"null-filler","click_on_complete":".left-bar .class_list .classes_container_class__add_class"}},{"el":null,"title":"That\'s all for now!","html":"Thanks for taking the tour! <br><br> If you have any questions, feel free to reach out to us by visiting the contact page (try using the title in the left sidebar to get to it from the homepage)! <br><br> In the meantime though, let\'s get you some more resources, then add your first class!","options":{"next_text":"Finish","end":true,"pagename":"tutorial","reclick":"null-filler"}}]');const V={class:"tutorialblurb modaltype",ref:"blurb"},F={key:0,class:"modal_header",ref:"title"},B={class:"header_style modal_header_title"},H={key:1,ref:"contents",class:"overlay_contents"},J=["innerHTML"],W={class:"bottom_actions"},z=(0,a._)("div",{class:"flex_spacer"},null,-1);function G(e,t,o,s,i,n){return!o.trackel||i.track?((0,a.wg)(),(0,a.iD)("div",{key:0,class:(0,r.C_)(["tutorialblurb_group",{tutorial_end:n.is_end}])},[(0,a._)("div",{class:"tutorialblurb__overlay",style:(0,r.j5)({top:i.track.top+"px",left:i.track.left+"px",height:i.track.height+"px",width:i.track.width+"px",borderRadius:o.options&&o.options.radius||"5px"})},null,4),(0,a._)("div",{class:"tutorialblurb_wrapper",ref:"dialog",style:(0,r.j5)({top:i.track.fake_y+"px",left:i.track.fake_x+"px"})},[i.track.blurb?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"tutorialblurb__blurb nopad",style:(0,r.j5)({left:i.track.blurb_x+"px"})},null,4)):(0,a.kq)("",!0),(0,a._)("div",V,[o.title?((0,a.wg)(),(0,a.iD)("header",F,[(0,a._)("h2",B,(0,r.zw)(o.title),1)],512)):(0,a.kq)("",!0),o.content||o.html?((0,a.wg)(),(0,a.iD)("div",H,[((0,a.wg)(),(0,a.j4)((0,a.LL)(o.content),{ref:"container",onSkip:t[0]||(t[0]=t=>e.$emit("skip"))},null,544)),o.html?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"overlay_contents__html",innerHTML:o.html},null,8,J)):(0,a.kq)("",!0)],512)):(0,a.kq)("",!0),(0,a._)("div",W,[o.skippable?((0,a.wg)(),(0,a.iD)("button",{key:0,class:"close_action click_escape",onClick:t[1]||(t[1]=t=>e.$emit("skip"))},(0,r.zw)(o.skip_text),1)):(0,a.kq)("",!0),z,(0,a._)("button",{class:"continue_action click_ctrlenter",onClick:t[2]||(t[2]=t=>e.$emit("next"))},(0,r.zw)(o.button_text),1)])],512)],4)],2)):(0,a.kq)("",!0)}var K=o(9529),Y=o.n(K),Q={name:"TutorialBlurb",emits:["next","skip"],props:{title:{type:String,required:!0},content:{type:Object},html:{type:String},button_text:{type:String,required:!1,default:"Next"},trackel:{required:!0},skippable:{type:Boolean,required:!1,default:!0},skip_text:{type:String,required:!1,default:"Skip"},options:{type:Object,required:!1}},data(){return{track:null,done_welcome:!1,shortcuts:[{key:"Enter, Space, ArrowRight",description:"Next Page"},{key:"ArrowLeft",description:"Back"}]}},mixins:[Y()],mounted(){this.$smoothReflow({el:this.$refs.contents,hideOverflow:!0,childTransitions:!0}),this.$smoothReflow({el:this.$refs.title,hideOverflow:!0,childTransitions:!0}),window.addEventListener("keydown",this.next_key),this.$shortcuts.register_all(this.shortcuts,"Tutorial"),window.addEventListener("resize",this.track_flush),window.addEventListener("scroll",this.track_flush),window.setInterval(this.track_flush,100),this.track_flush()},beforeUnmount(){window.removeEventListener("keydown",this.next_key),this.$shortcuts.remove_tag("Tutorial"),window.removeEventListener("resize",this.track_flush),window.removeEventListener("scroll",this.track_flush),window.clearInterval(this.track_flush)},computed:{is_end(){return this.options?.end}},methods:{track_fn(){const e=void 0===this.options?.padding?10:this.options.padding;if(this.trackel){const t=I()(this.trackel);if(t.length){const o={w:window.innerWidth,h:window.innerHeight,pad:10},s={w:350,h:(this.$refs?.dialog?.offsetHeight||200)+7,offset:o.w<=600?172:20,rail_pad:20},a=t.offset(),i=t.outerWidth(),r=t.outerHeight();let n={blurb:!0,top:a.top-e,left:a.left-e,width:i+2*e,height:r+2*e,x:a.left+i/2-s.offset,y:a.top+r+e+7,exists:!0};return n.fake_x=Math.max(o.pad,Math.min(o.w-s.w-o.pad,n.x)),n.fake_y=Math.max(o.pad,Math.min(o.h-s.h-o.pad,n.y)),n.fake_x+s.w>n.left&&n.fake_x<n.left+n.width&&n.fake_y+s.h>n.top&&n.fake_y<n.top+n.height?(n.blurb=!1,n.blurb_x=s.offset,n.fake_y=window.innerHeight/2-(this.$refs?.dialog?.offsetHeight||200)/2,n.fake_x=window.innerWidth/2-175):(n.blurb_x=n.x-n.fake_x+s.offset,n.blurb_x=Math.max(s.rail_pad,Math.min(s.w-s.rail_pad,n.blurb_x))),this.done_welcome||(new L.bF(`Welcome to ${this.$env.VUE_APP_BRAND_SHORT_NAME}, let's get you comfortable!`,3500),this.done_welcome=!0),n}}else if(null==this.trackel)return{exists:!1,blurb:!1,fake_y:window.innerHeight/2-(this.$refs?.dialog?.offsetHeight||200)/2,fake_x:window.innerWidth/2-175,top:window.innerHeight/2,left:window.innerWidth/2,width:0,height:0};return this.track},next_key(e){e.preventDefault(),this.track&&("Enter"===e.key||" "===e.key||"ArrowRight"===e.key?this.$emit("next"):"ArrowLeft"===e.key&&this.$emit("skip")),e.stopPropagation()},track_flush(){this.$store.done_tutorial||(this.track=this.track_fn(),this.options?.reclick&&I()(this.options.reclick).click(),this.options?.pagename&&this.$route.name!=this.options.pagename&&this.$route.path.startsWith("/portal")&&this.$router.push({name:this.options.pagename}))}},watch:{trackel(){this.track_flush()},$route(){this.track_flush()},options(){this.options?.end&&setTimeout((()=>{this.$emit("next")}),250)}}};const Z=(0,b.Z)(Q,[["render",G]]);var X=Z,ee={name:"App",components:{OverlayWrapper:k.Z,LogoutModal:P,TutorialBlurb:X,ShortcutsModal:M},data(){return{platform:"",isElectron:!1,animating:!1,animating_shortcuts:!1,tutorial_page:0,show_shortcuts:!1,shortcuts:[{key:"Ctrl + Enter",description:"Submit current form"},{key:"Escape",description:"Close current modal"},{key:"Ctrl + \\",description:"Toggle dark mode"},{key:"Ctrl + / or Ctrl + ?",description:"Toggle shortcuts menu"}]}},computed:{do_timeout(){return!this.$store?.account_doc?.prefs?.hide_timeout},pageTitle(){return document.title},theme(){return this.$store.get_theme},show_tutorial(){return!this.$store.done_tutorial&&R&&this.$store},tutorial(){const e=R[this.tutorial_page];return{...e,prev_text:this.tutorial_page&&!e.disable_prev?"Back":"",next_text:e.options?.next_text||(this.tutorial_page==R.length-1?"Finish":"Next")}}},mounted(){this.isElectron=navigator.userAgent.toLowerCase().indexOf(" electron/")>-1,this.isElectron&&(this.platform=this.$route.query.platform,!this.platform&&window.location.search&&(this.platform=window.location.search.split("=")[1]),console.log("Electron Platform: "+this.platform)),this.set_theme(),this.$store.paused=!1,this.$store.logout_prompt=!1,window.addEventListener("focus",this.refreshTimeout),window.addEventListener("keydown",this.global_keydown),this.$shortcuts.register_all(this.shortcuts,"General"),this.$refs.app.addEventListener("click",(e=>{if(e.target.href){e.target.href.includes("://")&&!e.target.href.startsWith("/")||(e.target.href=new URL(e.target.href,window.location.href).href);let t=new URL(e.target.href);if(t?.hostname==this.$env.VUE_APP_BRAND_DOMAIN||t?.hostname==window?.location?.hostname)return;e.preventDefault(),this.$status.log(`🔗 Opening outlink in a new tab | "${t.href}"`),window.open("/to/"+encodeURIComponent(t.href),"_blank")}}))},beforeUnmount(){window.removeEventListener("focus",this.refreshTimeout),window.removeEventListener("keydown",this.global_keydown),this.$shortcuts.remove_tag("General")},created(){const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",t=window.localStorage.getItem("theme");this.isDarkMode="dark"===t||null===t&&"dark"===e},methods:{global_keydown(e){let t,o=!1;if(this.show_shortcuts&&(o=!0),e.shiftKey||"Escape"!=e.key||e.ctrlKey||e.metaKey?e.shiftKey||"Enter"!=e.key||!e.ctrlKey&&!e.metaKey?e.shiftKey||"\\"!=e.key||!e.ctrlKey&&!e.metaKey?("/"==e.key&&(e.ctrlKey||e.metaKey)||"?"==e.key&&(e.ctrlKey||e.metaKey))&&(this.show_shortcuts=!this.show_shortcuts,o=!0):(this.$store.toggle_theme(),o=!0):t=I()(".click_ctrlenter"):t=I()(".click_escape"),t){if(t=t.not("[disabled]").not(".disabled").filter(":visible"),!t||!t.length)return;I()(t).first().click()}(t||o)&&(e.preventDefault(),e.stopPropagation())},tutorial_nav(e){const t=this.tutorial?.options?.click_on_complete;e>0&&t&&I()(1==t?this.tutorial.el:t).click(),this.tutorial_page==R.length-1?this.$store.finish_tutorial(!0).then((()=>{new L.bF("Interface tutorial completed; here's some more resources!",3500)})).catch((e=>{new L.PK("Couldn't complete tutorial",e,3e3)})):this.tutorial_page+e>=0&&(!this.tutorial.disable_prev||e>0)&&(this.tutorial_page+=e)},refreshTimeout(){this.$store&&this.$store.refresh_timeout()},set_theme(){"light"==this.theme?(I()("meta.theme-color").attr("media",""),I()("meta.theme-color-dark").attr("media","false")):(I()("meta.theme-color-dark").attr("media",""),I()("meta.theme-color").attr("media","false"))}},watch:{"$store.paused":function(e,t){this.do_timeout&&(e?this.$nextTick((()=>{this.$refs.pause_modal.focus()})):t&&this.$refs.overlay&&(this.animating=!0,this.$refs.overlay.close(),setTimeout((()=>{this.animating=!1}),250)))},show_shortcuts:function(e,t){t&&this.$refs.shortcuts_overlay&&(this.animating_shortcuts=!0,this.$refs.shortcuts_overlay.close(),setTimeout((()=>{this.animating_shortcuts=!1}),250))},theme(){this.set_theme()}}};const te=(0,b.Z)(ee,[["render",g],["__scopeId","data-v-01c17384"]]);var oe=te,se=o(2483);const ae={class:"apphome hidescroll scrolloverflow"},ie={class:"base fullheightcontent"};function re(e,t,o,s,i,r){const n=(0,a.up)("BaseNav"),l=(0,a.up)("router-view"),c=(0,a.up)("BaseFooter");return(0,a.wg)(),(0,a.iD)("main",ae,[(0,a._)("main",ie,[(0,a.Wm)(n),(0,a.Wm)(l,{class:"inner-base"})]),(0,a.Wm)(c)])}const ne=e=>((0,a.dD)("data-v-a48c6f58"),e=e(),(0,a.Cn)(),e),le={class:"gohome hideoverflow"},ce=["_theme"],de=ne((()=>(0,a._)("div",{class:"theme_icon"},null,-1))),ue=ne((()=>(0,a._)("div",{class:"toggle_text"},"Switch Theme",-1))),he=[de,ue],me=ne((()=>(0,a._)("span",{class:"flex_spacer"},null,-1))),_e={class:"base-pages-nav"},pe=ne((()=>(0,a._)("span",{class:"flex_spacer"},null,-1)));function fe(e,t,o,s,i,n){const l=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("header",null,[(0,a._)("h1",le,(0,r.zw)(e.$env.VUE_APP_BRAND_LONG_NAME),1),(0,a._)("button",{_theme:e.$store.get_theme,class:"theme_button",title:"Switch Theme",onClick:t[0]||(t[0]=(...t)=>e.$store.toggle_theme&&e.$store.toggle_theme(...t))},he,8,ce),me,i.mobile&&!i.mobile_menu_open?((0,a.wg)(),(0,a.iD)("button",{key:0,class:"nav-mobile-btn",onClick:t[1]||(t[1]=e=>i.mobile_menu_open=!i.mobile_menu_open)})):(0,a.kq)("",!0),!i.mobile||i.mobile_menu_open?((0,a.wg)(),(0,a.iD)("div",{key:1,class:(0,r.C_)(["nav-actions",{mobile:i.mobile}])},[i.mobile?((0,a.wg)(),(0,a.iD)("button",{key:0,class:"nav-mobile-btn alt-btn",onClick:t[2]||(t[2]=e=>i.mobile_menu_open=!i.mobile_menu_open)})):(0,a.kq)("",!0),(0,a._)("nav",_e,[(0,a.Wm)(l,{class:"click-action-inline",to:"/",onClick:n.closeMenu},{default:(0,a.w5)((()=>[(0,a.Uk)("Home")])),_:1},8,["onClick"]),(0,a.Wm)(l,{class:"click-action-inline",to:"/about",onClick:n.closeMenu},{default:(0,a.w5)((()=>[(0,a.Uk)("About")])),_:1},8,["onClick"]),(0,a.Wm)(l,{class:"click-action-inline",to:"/contact",onClick:n.closeMenu},{default:(0,a.w5)((()=>[(0,a.Uk)("Contact")])),_:1},8,["onClick"])]),pe,(0,a._)("button",{id:"nav-auth-btn",class:(0,r.C_)(["small-action-btn auth-action can-logout can-login click-action",{linked:e.$store.personal_account&&e.$store.user,oauth:!n.logged_in}])}," Log "+(0,r.zw)(n.logged_in?"Out":"In"),3)],2)):(0,a.kq)("",!0)])}var ge={name:"BaseNav",data(){return{mobile_menu_open:!1,mobile:window.innerWidth<=800}},methods:{resize(){this.mobile=window.innerWidth<=800,this.mobile||this.closeMenu()},closeMenu(){this.mobile_menu_open=!1}},mounted(){window.addEventListener("resize",this.resize)},unmounted(){window.removeEventListener("resize",this.resize)},computed:{logged_in(){return!!this.$store.user}}};const ke=(0,b.Z)(ge,[["render",fe],["__scopeId","data-v-a48c6f58"]]);var we=ke;const ye=e=>((0,a.dD)("data-v-09e9e1d4"),e=e(),(0,a.Cn)(),e),ve={class:"desktop_only_text"},be={class:"mobile_only_text"},xe=ye((()=>(0,a._)("span",null,[(0,a.Uk)("Website by "),(0,a._)("a",{href:"https://svonk.me/"},"Sander Vonk"),(0,a.Uk)(".")],-1)));function Pe(e,t,o,s,i,n){const l=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("footer",null,[(0,a._)("p",null,[(0,a._)("span",null,[(0,a.Uk)("© 2022-2023 "),(0,a._)("span",ve,(0,r.zw)(e.$env.VUE_APP_BRAND_LONG_NAME),1),(0,a._)("span",be,(0,r.zw)(e.$env.VUE_APP_BRAND_SHORT_NAME),1),(0,a.Uk)(". ")]),(0,a.Uk)("   "),xe,(0,a._)("span",null,[(0,a.Uk)("   Legal: "),(0,a._)("span",null,[(0,a.Wm)(l,{to:"/legal/privacy"},{default:(0,a.w5)((()=>[(0,a.Uk)("Privacy Policy")])),_:1}),(0,a.Uk)(", ")]),(0,a._)("span",null,[(0,a.Wm)(l,{to:"/legal/terms"},{default:(0,a.w5)((()=>[(0,a.Uk)("Terms of Service")])),_:1})])])])])}var Te={name:"BaseFooter"};const Ae=(0,b.Z)(Te,[["render",Pe],["__scopeId","data-v-09e9e1d4"]]);var Ce=Ae,$e={name:"AppHome",components:{BaseNav:we,BaseFooter:Ce}};const Oe=(0,b.Z)($e,[["render",re]]);var Se=Oe;const Ne=e=>((0,a.dD)("data-v-0d69843e"),e=e(),(0,a.Cn)(),e),De={class:"not-found"},je=Ne((()=>(0,a._)("h1",{class:"title_text err_text"},"404",-1))),qe=Ne((()=>(0,a._)("h2",{class:"header_style err_text hideoverflow"},"Page Not Found",-1))),Ee=Ne((()=>(0,a._)("hr",{class:"err-break"},null,-1))),Me=Ne((()=>(0,a._)("span",null," | ",-1))),Ue={key:1,class:"nostyle"},Ie=Ne((()=>(0,a._)("span",null," | ",-1))),Le=Ne((()=>(0,a._)("div",{class:"err-pad-bottom"},null,-1)));function Re(e,t,o,s,i,r){const n=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("div",De,[je,qe,Ee,(0,a._)("nav",null,[(0,a.Wm)(n,{class:"router-link click-action-inline",to:"/"},{default:(0,a.w5)((()=>[(0,a.Uk)("Home")])),_:1}),Me,r.logged_in?((0,a.wg)(),(0,a.j4)(n,{key:0,class:"router-link click-action-inline",to:"/portal"},{default:(0,a.w5)((()=>[(0,a.Uk)("Portal")])),_:1})):((0,a.wg)(),(0,a.iD)("span",Ue,[(0,a.Wm)(n,{class:"router-link click-action-inline",to:"/about"},{default:(0,a.w5)((()=>[(0,a.Uk)("About")])),_:1}),Ie,(0,a.Wm)(n,{class:"router-link click-action-inline",to:"/contact"},{default:(0,a.w5)((()=>[(0,a.Uk)("Contact")])),_:1})]))]),Le])}var Ve={name:"NotFound",computed:{logged_in(){return this.$store.user}}};const Fe=(0,b.Z)(Ve,[["render",Re],["__scopeId","data-v-0d69843e"]]);var Be=Fe;const He=(0,se.p7)({history:(0,se.PO)("/"),routes:[{path:"/",name:"home",component:Se,meta:{page_title:"Home",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1},children:[{path:"",name:"home",component:()=>o.e(533).then(o.bind(o,8533)),meta:{page_title:"Home",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1},children:[{path:"/view/:ref([^~]+~[^~]+~[^~]+)",name:"publicviewtask",component:()=>Promise.all([o.e(478),o.e(261)]).then(o.bind(o,261)),meta:{page_title:"View Task",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1}},{path:"/view/:ref([^~]+~[^~]+)",name:"publicviewclass",component:()=>Promise.all([o.e(478),o.e(350)]).then(o.bind(o,8350)),meta:{page_title:"View Class",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1}},{path:"to/:path?",name:"redirect",component:()=>o.e(274).then(o.bind(o,274)),meta:{page_title:"Confirm Redirect",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1}},{path:"join",name:"join",component:()=>o.e(496).then(o.bind(o,3496)),meta:{page_title:"Join the MVTT Beta",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},requiresAuth:!1,close_path:"/",blockStandardRedirect:!0}},{path:"link/:code?",name:"link",component:()=>o.e(50).then(o.bind(o,3050)),props:!0,meta:{page_title:"Link Personal Account",theme_color:{light:"#bfbfbf",dark:"#0d0d0d"},close_path:"/",blockStandardRedirect:!0}}]},{path:"about",name:"about",component:()=>o.e(557).then(o.bind(o,6557)),meta:{page_title:"About",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"legal/privacy",name:"privacy",component:()=>o.e(682).then(o.bind(o,4261)),meta:{page_title:"Legal - Privacy Policy",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"legal/tos",name:"tos",component:()=>o.e(265).then(o.bind(o,5265)),meta:{page_title:"Legal - Terms of Service",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"download",name:"download",component:()=>o.e(782).then(o.bind(o,782)),meta:{page_title:"Download [BETA]",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"roadmap",name:"roadmap",component:()=>o.e(755).then(o.bind(o,6755)),meta:{page_title:"Development Roadmap",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"contact",name:"contact",component:()=>o.e(552).then(o.bind(o,3552)),meta:{page_title:"Contact",theme_color:{light:"#ffffff",dark:"#16130e"},requiresAuth:!1}},{path:"/:pathMatch(.*)*",name:"404",component:Be,meta:{page_title:"404",theme_color:{light:"#ffffff",dark:"#16130e"}}}]},{path:"/portal",name:"portal",component:()=>o.e(34).then(o.bind(o,2627)),meta:{page_title:"Portal",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0},children:[{path:"/portal/tutorial/:tab?",name:"tutorial",component:()=>o.e(790).then(o.bind(o,8790)),meta:{page_title:"Tutorial Videos",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/portal/tutorial/add",name:"onboarding",component:()=>o.e(391).then(o.bind(o,391)),meta:{page_title:"Onboarding",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,block_close:!0,noSurvey:!0}},{path:"/portal/study",name:"study",component:()=>o.e(34).then(o.bind(o,2627)),meta:{page_title:"Study Portal",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/portal/statistics",name:"stats",component:()=>o.e(781).then(o.bind(o,8873)),meta:{page_title:"View Statistics",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/survey/daily",name:"daily",component:()=>o.e(385).then(o.bind(o,8385)),meta:{page_title:"Daily Check-In",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,block_close:!0,blockStandardRedirect:!0,noSurvey:!0}},{path:"/portal/settings",name:"settings",component:()=>o.e(65).then(o.bind(o,4065)),meta:{page_title:"Settings",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,noSurvey:!0}},{path:"/portal/add",name:"addclass",component:()=>o.e(838).then(o.bind(o,6838)),meta:{page_title:"Join a Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/add/ref/:ref?",name:"refclass",component:()=>o.e(838).then(o.bind(o,6838)),meta:{page_title:"Join from Reference",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/add/code/:code",name:"codeclass",component:()=>o.e(838).then(o.bind(o,6838)),meta:{page_title:"Join from Code",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/add/code",name:"codeenterclass",component:()=>o.e(543).then(o.bind(o,8543)),meta:{page_title:"Enter Class Code",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/create",name:"createclass",component:()=>o.e(780).then(o.bind(o,5780)),meta:{page_title:"Teacher | Create Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/new/:tasktype?",name:"newtask",component:()=>o.e(251).then(o.bind(o,3251)),meta:{page_title:"Teacher | Add Task",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/notes/:ref?",name:"notes",component:()=>o.e(490).then(o.bind(o,2490)),meta:{page_title:"Your Task Notes",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/view/:ref?",name:"viewtask",component:()=>Promise.all([o.e(478),o.e(261)]).then(o.bind(o,261)),meta:{page_title:"View Task",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/view/:ref([^~]+~[^~]+)",name:"viewclass",component:()=>Promise.all([o.e(478),o.e(350)]).then(o.bind(o,8350)),meta:{page_title:"View Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}},{path:"/portal/edit/t/:ref?",name:"edit",component:()=>o.e(862).then(o.bind(o,9862)),meta:{page_title:"Edit Task",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/edit/c/:ref?",name:"editclass",component:()=>o.e(877).then(o.bind(o,6877)),meta:{page_title:"Edit Class",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/archive/:type?/:ref?",name:"archive",component:()=>o.e(390).then(o.bind(o,4390)),meta:{page_title:"Confirm Task Archive",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0,requiresTeacher:!0}},{path:"/portal/leave/:ref?",name:"leave",component:()=>o.e(395).then(o.bind(o,6395)),meta:{page_title:"Confirm Class Leave",theme_color:{light:"#b5b5b5",dark:"#0d0d0d"},requiresAuth:!0}}]},{path:"/portal/calendar",name:"calendar",redirect:"/portal?calendar=true",meta:{page_title:"Calendar",theme_color:{light:"#f2f2f2",dark:"#121212"},requiresAuth:!0}},{path:"/app",redirect:"/portal",meta:{requiresAuth:!0}},{path:"/study",redirect:"/portal/study",meta:{requiresAuth:!0}},{path:"/settings",redirect:"/portal/settings",meta:{requiresAuth:!0}},{path:"/survey/daily",redirect:"/portal/survey/daily",meta:{requiresAuth:!0}}],parseQuery:e=>o(5410).parse(e)});var Je=He,We=o(407),ze=o.n(We),Ge=o(2745),Ke=o(5431);(0,Ke.z)("/service-worker.js",{ready(){Ge.i2.log("🛠 App is being served from cache by a service worker. For more details, visit https://goo.gl/AFskqB")},registered(){Ge.i2.log("🛠 Service worker has been registered.")},cached(){Ge.i2.log("🛠 Content has been cached for offline use.")},updatefound(){Ge.i2.log("🛠 New content is downloading.")},updated(){Ge.i2.log("🛠 New content is available; please refresh."),window.localStorage.clear(),window.location.reload(!0)},offline(){Ge.i2.log("🛠 No internet connection found. App is running in offline mode.")},error(e){Ge.i2.error("🛑 Error during service worker registration:",e)}});var Ye=o(6112),Qe=o(4287),Ze=o(8082),Xe=o.n(Ze),et=o(7795),tt=o(6665),ot=o(6781);const st={apiKey:"AIzaSyDGqqhApln4pxm4EynPCSkfwyK8aopjfCk",authDomain:"auth.mvtt.app",projectId:"mvtrack",storageBucket:"mvtrack.appspot.com",messagingSenderId:"1070634963357",appId:"1:1070634963357:web:2a4abc725fff24a5199f74",measurementId:"G-6LNX1KCR8E"},at=(0,et.ZF)(st),it=(0,tt.v0)(at),rt=(0,Qe.ad)(at);(0,ot.IH)(at);let nt;it.onAuthStateChanged((e=>{dt(e)}));let lt,ct=!1;function dt(e){const t=bt();if(e){if(t.set_user(e),ht(),!t.user)return;ut(e.uid),lt=_t()}else t.clear()}function ut(e){if(Ge.i2.log("⬥ Setting up snapshot"),!e)return void Ge.i2.warn("⚠ No uid provided to setupSnapshot");const t=bt();t.hide_timeout(),nt=(0,Qe.cf)((0,Qe.JU)(rt,"users",e),{includeMetadataChanges:!0},(e=>{if(e.metadata.hasPendingWrites)return void Ge.i2.log("⬥ Snapshot from local changes");if(Ge.i2.log("⏷ Snapshot from remote"),!e.exists())return void t.create_doc();let o=e.data();t?.user?.uid==e.id?t.account_doc=o:t.linked_account_doc=o}),(e=>{"permission-denied"==e.code?Ge.i2.warn("⚠ Permission denied for snapshot, likely from logging out"):Ge.i2.error("⚠ Couldn't get snapshot from remote",e)})),ct=!0}function ht(e){clearTimeout(lt);let t=bt();e&&t.show_timeout(),nt&&(nt(),Ge.i2.log("⬥ Unsubscribed from remote changes")),ct=!1}function mt(e){const t=Math.floor(e/1e3/60),o=Math.floor(e/1e3%60);return(t||!o?`${t} minute${1!=t?"s":""}`:"")+(o?`${o} second${1!=o?"s":""}`:"")}function _t(e=3e5){return setTimeout((()=>{Ge.i2.log(`⬥ Page unused for ${mt(e)}, removing onSnapshot listener`),ht(!0)}),e)}function pt(e){const t=bt();t.hide_timeout(),ct||(ut(t.personal_account?t.account_doc?.linked_to:t.user.uid),Je.currentRoute.value&&Je.currentRoute.value.path.startsWith("/portal")&&(Ge.i2.log("⬥ Refreshing class data"),t.fetch_classes()),Ge.i2.log("⬥ Resubscribed to remote changes")),clearTimeout(lt),lt=_t(e)}const ft=new tt.hJ,gt=navigator?.userAgent?.toLowerCase()?.indexOf(" electron/")>-1,kt="@mvla.net";function wt(e){return e?.split("@")[1]==kt.substring(1)}function yt(){try{return window.self!==window.top}catch(e){return!0}}ft.addScope("email"),ft.addScope("profile"),it.useDeviceLanguage(),ft.setCustomParameters({login_hint:"username"+kt});let vt=new Date;vt=new Date(vt.getTime()-60*vt.getTimezoneOffset()*1e3),vt=vt.toISOString().split("T")[0];const bt=(0,i.Q_)({id:"main",state:()=>{let e={},t=window.localStorage.getItem("MVTT_app_state");if(t&&"undefined"!=t&&"null"!=t)try{return Ge.i2.log("↻ State from local storage"),e=JSON.parse(t),e.paused=!1,e.logout_prompt=!1,e}catch(o){Ge.i2.warn("⟳ Error parsing local storage state",o)}return Ge.i2.log("🔨 Setting up store from scratch"),{user:null,account_doc:null,linked_account_doc:null,classes:[],tasks:[],loaded_email:null,loaded_classes:null,teacher:{doc_ref:null,collection_ref:null},theme:null,personal_account:!1,paused:!1,logout_prompt:!1}},getters:{ORG_DOMAIN(){return kt},simplified(){return this.account_doc?.prefs?.simplified||!1},linked_accounts(){return this.user&&this.active_doc&&this.active_doc.linked||[]},upcoming(){if(!this.tasks)return[];const e=Date.now(),t=288e5;let o=this.tasks.filter((o=>"note"!=o.type&&(o?.date?.getTime?o.date.getTime():0)>=e-t));return o.sort(((e,t)=>e.date<t.date?-1:e.date>t.date?1:0)),o},upcoming_todo(){return this.upcoming?this.upcoming.filter((e=>!this.finished_tasks?.includes(e.ref))):[]},non_recent_signin(){if(!this.user)return!1;let e=this.user?.metadata?.lastSignInTime;if(!e)return!1;e=new Date(e);let t=(new Date).getTime()-e.getTime();return t>864e5},recently_joined(){if(!this.user)return!1;let e=this.user?.metadata?.creationTime;if(!e)return!1;e=new Date(e);let t=(new Date).getTime()-e.getTime();return t<432e5},is_teacher(){if(!this.user)return!1;if(1==this.active_doc?.teacher_mode||"true"==window?.localStorage?.["MVTT_teacher_mode"]){if(1==this.active_doc?.teacher_mode||null==this.active_doc?.teacher_mode)return window.localStorage.setItem("MVTT_teacher_mode",!0),this.personal_account?(Ge.i2.log("🏫 No teacher mode for personal account"),!1):(Ge.i2.log("🏫 Local teacher mode"),!0);window.localStorage.setItem("MVTT_teacher_mode",!1),Ge.i2.log("🏫 Teacher mode disabled locally to reflect remote changes")}let e=this.user.email,[t,o]=e.split("@");return"@"+o==this.ORG_DOMAIN&&!/\d/.test(t)&&(Ge.i2.log("🏫 Teacher mode enabled for non-student district account"),!0)},done_daily_survey(){return!this.done_tutorial||!!this.active_doc&&(this.active_doc?.done_surveys&&this.active_doc.done_surveys?.includes(vt))},done_tutorial(){return!!this.account_doc&&this.account_doc?.done_tutorial},done_join_form(){return!!this.user&&!!this.active_doc?.join_form},account_ref(){return this.user?(0,Qe.JU)(rt,"users",this.user.uid):null},linked_account_ref(){return this.user&&this.account_doc&&this.account_doc.linked_to?(0,Qe.JU)(rt,"users",this.account_doc.linked_to):null},active_ref(){return this.personal_account?this.linked_account_ref:this.account_ref},active_doc(){return this.personal_account?this.linked_account_doc:this.account_doc},get_theme(){let e=this.theme||window.localStorage.getItem("theme"),t=this.account_doc?.prefs?.theme,o=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";return t?(e!=t&&window.localStorage.setItem("theme",t),t||"light"):(e?o=e:window.localStorage.setItem("theme",o),this.account_doc&&(this.account_doc.prefs={...this.account_doc.prefs,theme:o},this.update_wrapper_acc_doc()),e||"light")},get_loaded_classes(){if(!this.loaded_classes||!this.loaded_classes.length)return[];let e=this.loaded_classes;return e.map((e=>(e.is_joined=this.active_doc?.classes?.includes([this.loaded_email,e?.id].join("/")),e)))},finished_tasks(){try{if(!this.active_doc)throw"No active doc";return this.active_doc.finished||[]}catch(e){Ge.i2.warn("🔗 Couldn't get finished tasks",e)}},notes(){try{if(!this.active_doc)throw"No active doc";return this.active_doc.notes||{}}catch(e){return Ge.i2.warn("🔗 Couldn't get notes",e),{}}}},actions:{class_text(e){if(e)return e.period?`P${e.period} - ${e.name}`:e.name},async set_account_pref(e,t){try{if(!this.account_ref)throw"No account doc";if(!e)throw"No pref provided";return await this.update_wrapper_with_merge({prefs:{...this.active_doc.prefs,[e]:t}}),Promise.resolve()}catch(o){return Promise.reject(o)}},get_surveys(e){try{let t=e.map((e=>(0,Qe.JU)(rt,"survey","daily",e,this.personal_account?this.account_doc.linked_to:this.user.uid))),o=t.map((e=>(0,Qe.QT)(e)));return Promise.all(o).then((t=>{let o=t.map(((t,o)=>t.exists()?{date:e[o],data:t.data()}:{date:e[o],error:"No survey data for this date"}));return Promise.resolve(o)}))}catch(t){return Promise.reject(t)}},async get_cached_surveys(e,t=!1){try{const o=(0,Qe.JU)(rt,"processed_surveys",this.personal_account?this.account_doc.linked_to:this.user.uid),s=await(0,Qe.QT)(o),a=s.exists()&&s.data()?.list||[],i=a?.map((e=>e.date)),r=a?.filter((e=>e.error))?.map((e=>e.date))||[],n=e.every((e=>i.includes(e)));if(n&&!t)return Ge.i2.log("📊 Using cached surveys"),Promise.resolve(a);{t&&Ge.i2.log("📊 Forcing refresh of surveys");const s=t?e:e.filter((e=>!i.includes(e)||r.includes(e))),n=await this.get_surveys(s);let l=[];for(let t of e)s.includes(t)?l.push(n[s.indexOf(t)]):l.push(a[i.indexOf(t)]);return await(0,Qe.pl)(o,{list:l,updated:Date.now()},{merge:!0}),Ge.i2.log("📊 Got surveys from server"),Promise.resolve(l)}}catch(o){return Promise.reject(o)}},note_for(e){return this.notes&&this.notes[this.ref_to_path(e)]||null},async set_note(e,t){try{if(!this.active_doc)throw"No active doc";if(!t)throw"No ref provided";let o=this.ref_to_path(t),s=this.active_doc;return s.notes||(s.notes={}),s.notes[o]=e||null,this.set_active(s),await this.update_remote(),Promise.resolve()}catch(o){return Promise.reject(o)}},async set_finished(e,t){try{if(!this.active_doc)throw"No active doc";if(!t)throw"No ref provided";let o=t,s=this.active_doc;return s.finished||(s.finished=[]),e?s.finished.push(o):s.finished=s.finished.filter((e=>e!=o)),this.set_active(s),await this.update_remote(),Promise.resolve()}catch(o){return Promise.reject(o)}},path_to_ref(){let e=[...arguments].join("/");if(!e.length)return null;let[t,o,s]=e.split("/");return t&&o?(t=t.split("@")[0],s?`${t}~${o}~${s}`:`${t}~${o}`):null},ref_to_path(){let e=[...arguments].join("~");if(!e.length)return null;let[t,o,s]=e.split("~");return t&&o?(t+=this.ORG_DOMAIN,s?`${t}/${o}/${s}`:`${t}/${o}`):null},hash(e){let t=Xe().SHA256(e).toString();return t.substring(0,5)},async code_from_ref(e){try{if(!e)return Promise.reject("No ref provided");e=e.split("~").join("/");let[t,o]=e.split("/");if(!t||!o)return Promise.reject("Invalid ref");t=t.split("@")[0]+this.ORG_DOMAIN,e=t+"/"+o;const s=this.hash(e);let a=this.classes.find((t=>t.id==e));if(a?.code!==s){const a=(0,Qe.JU)(rt,"codes",s);await(0,Qe.pl)(a,{ref:e});const i=(0,Qe.JU)(rt,"classes",t,"classes",o);await(0,Qe.r7)(i,{code:s},{merge:!0})}return Promise.resolve(s)}catch(t){return Promise.reject(t)}},async ref_from_code(e){try{if(!e)throw"No code provided";const t=(0,Qe.JU)(rt,"codes",e),o=await(0,Qe.QT)(t);if(Ge.i2.log("🔗 Got code doc",o.data()),!o.exists())throw"Code doesn't exist";let s=this.path_to_ref(o.data()?.ref);if(!s)throw"Code doesn't have ref";return Promise.resolve(s)}catch(t){return Promise.reject(t)}},async toggle_teacher(){if(!this.user)return;let e=this.active_doc?.teacher_mode||"true"==window.localStorage.getItem("MVTT_teacher_mode");window.localStorage.setItem("MVTT_teacher_mode",!e);let t=e?"off":"on";this.active_doc&&(this.active_doc.teacher_mode=!e,await this.update_remote(),Ge.i2.log(`🏫 Remote teacher mode toggled ${t}`)),Ge.i2.log(`🏫 Local teacher mode toggled ${t}`),new L.bF(`Teacher mode toggled ${t}`,2e3)},async get_tasks(){try{if(!this.classes?.length)return Promise.resolve([]);let e=[],t=this.classes;for(let o=0;o<t.length;o++){let s=t[o].tasks;s=s||[];for(let a=0;a<(s?.length||0);a++){if(t[o].name=t[o].name?t[o].name:"Unnamed Class","string"==typeof s[a].date){s[a].date=s[a].date.split("T")[0];let[e,t,o]=s[a].date.split("-");s[a].date=`${t}-${o}-${e}`,s[a].date=(0,Ge.HU)(s[a].date),s[a].date=isNaN(s[a].date)?null:s[a].date}s[a].color=t[o].color,e.push({...s[a],class_name:this.class_text(t[o])})}}return e.sort(((e,t)=>(e.name=e.name?e.name:"",t.name=t.name?t.name:"",e.date&&t.date?e.date.getTime()==t.date.getTime()?e.period==t.period?e.name.localeCompare(t.name):e.period-t.period:e.date.getTime()-t.date.getTime():e.name.localeCompare(t.name)))),this.tasks=e,Promise.resolve(e)}catch(e){return Promise.reject(e)}},clear(){this.user=null,this.account_doc=null,this.linked_account_doc=null,this.classes=[],this.tasks=[],this.loaded_email=null,this.loaded_classes=null,this.personal_account=!1,this.teacher={doc_ref:null,collection_ref:null},window.localStorage.removeItem("MVTT_app_state"),Je.currentRoute?.value?.meta?.requiresAuth&&Je.push("/")},set_active(e){try{if(!e)throw"No data provided";return this.personal_account?this.linked_account_doc=e:this.account_doc=e,Promise.resolve()}catch(t){return Promise.reject(t)}},async doc_from_uid(e){try{if(!e)throw"No account uid provided";let t=await(0,Qe.QT)((0,Qe.JU)(rt,"users",e));if(Ge.i2.log("🔗 Got linking account's document"),!t.exists())throw"Account doesn't exist or you haven't been added yet";let o=t.data();return Promise.resolve(o)}catch(t){return Ge.i2.warn("🔗 Couldn't get linking account's document",t),Promise.reject(t)}},async link_account_uid(e){if(e)if(this.personal_account){this.account_doc||(await this.create_doc(),Ge.i2.log("📄 Dreated doc",this.account_doc));try{let t=await this.doc_from_uid(e);if(!t)throw"Account doesn't exist or you haven't been invited";this.account_doc.linked_to=e,await this.update_wrapper_acc_doc(),new L.bF(`Successfully linked to ${t.name}'s account!`,4e3)}catch(t){return new L.PK("Couldn't link account",t,2e3),Promise.reject(t)}}else new L.OO("This account is a primary account and cannot be linked",3e3)},async invite_linked(e){if(!this.user||!this.active_doc)return;if(this.personal_account&&new L.OO("This account is already linked!",2e3),!e||wt(e)||!e.includes("@"))return void new L.OO("Please enter a valid non-mvla email",2e3);if(this.linked_accounts.includes(e))return void new L.OO("That account is already linked",2e3);this.active_doc.linked||(this.personal_account?this.linked_account_doc.linked=[]:this.account_doc.linked=[]);let t=(0,Qe.hJ)(rt,"mail");try{let o=await(0,Qe.ET)(t,{to:e,cc:this.user.email,from:`${this.active_doc.name} via MV Test Tracker <mail@mvtt.app>`,fromname:this.active_doc.name+" via MV Test Tracker",template:{name:"link_invite",data:{sender_name:this.active_doc.name.split(" ")[0],sender_uid:this.user.uid}}}),s=(0,Qe.JU)(t,o.id),a=await(0,Qe.QT)(s),i=1;while(!a.exists()||0==!!a.data()?.delivery?.attempts&&i<=3)await new Promise((e=>setTimeout(e,2e3*(2^i)))),a=await(0,Qe.QT)(s),Ge.i2.log("📧 Checked email doc"),i++;if(!a.data()?.delivery?.info?.accepted?.includes(e)||0==a.data()?.delivery?.attempts)throw Ge.i2.log("📧 Email failed to send",a.data()),"Email failed to send";return this.personal_account?this.linked_account_doc.linked.push(e):this.account_doc.linked.push(e),await this.update_remote(),new L.bF(`We notified ${e}, you'll receive a copy of the email too!`,4e3),Promise.resolve()}catch(o){return new L.PK(`Couldn't invite "${e}"`,o,2e3),Promise.reject(o)}},async uninvite_linked(e){try{if(!this.user)return;if(this.active_doc.linked.includes(e)){let t=this.active_doc.linked.filter((t=>t!=e));this.personal_account?this.linked_account_doc.linked=t:this.account_doc.linked=t,await this.update_remote(),new L.bF(`Removed ${e} from your linked accounts`,2e3)}else new L.OO(`${e} is not linked to this account`,2e3);Promise.resolve()}catch(t){return new L.PK(`Couldn't unlink "${e}"`,t,2e3),Promise.reject(t)}},refresh_timeout(e){this.paused=!1,this.user&&pt(e)},async login_promise(){return new Promise((e=>{let t=setInterval((()=>{this.user&&(clearInterval(t),e(this.user))}),100)}))},async save_join_form(e){try{if(!this.user||!this.active_doc)throw"No doc to save join form to";return this.personal_account?(this.linked_account_doc=this.linked_account_doc||{},this.linked_account_doc.join_form=e):(this.account_doc=this.account_doc||{},this.account_doc.join_form=e),await this.update_remote(),Promise.resolve()}catch(t){return Promise.reject(t)}},async finish_tutorial(e){try{if(!this.user||!this.account_doc)throw"No doc to save tutorial status to";return this.account_doc.done_tutorial=e,await this.update_wrapper_with_merge({done_tutorial:e}),Promise.resolve()}catch(t){return Promise.reject(t)}},async save_daily_survey(e){try{this.user||await this.login_promise();let t=(0,Qe.JU)(rt,"survey","daily",vt,this.personal_account?this.account_doc?.linked_to:this.user.uid),o={time:(new Date).getTime(),responses:e};await(0,Qe.pl)(t,o);let s=this.active_doc?.done_surveys?this.active_doc.done_surveys:[];return s.push(vt),this.personal_account?this.linked_account_doc.done_surveys=s:this.account_doc.done_surveys=s,await this.update_remote(),new L.bF("Saved daily survey",2e3),Promise.resolve()}catch(t){return new L.PK("Couldn't save daily survey",t,2e3),Promise.reject(t)}},async toggle_theme(){this.theme="light"==this.get_theme?"dark":"light",window.localStorage.setItem("theme",this.theme),this.account_doc&&(this.account_doc.prefs={...this.account_doc.prefs,theme:this.theme},delete this.account_doc.theme,await this.update_wrapper_acc_doc()),new L.bF(`Switched to ${this.theme} theme`,2e3),this.theme=this.get_theme},async remove_class_id_helper(e){let t=this.active_doc.classes.filter((t=>t!=e));this.personal_account?this.linked_account_doc.classes=t:this.account_doc.classes=t,this.classes=this.classes.filter((t=>t.id!=e)),this.get_tasks(),await this.update_remote()},async remove_invalid(e){return await this.remove_class_id_helper(e),new L.OO(`Removed non-existent class "${e}"`,2e3),Promise.resolve()},async remove_class(e){try{return await this.remove_class_id_helper(e),Ge.i2.log("🗑️ Removed class from user's doc: "+e),new L.bF("Left class",2e3),Promise.resolve()}catch(t){return Ge.i2.log("🔥 Error removing class from user's doc: "+t),new L.PK("Couldn't leave class",t,2e3),Promise.reject(t)}},set_user(e){Ge.i2.log("🔑 Setting user"),(0,Qe.QT)((0,Qe.JU)(rt,"users",e.uid)).then((t=>{if(t.exists()?(this.account_doc=t.data(),this.personal_account=this.account_doc?.personal_account):(this.account_doc=null,this.linked_account_doc=null),!e.email||!wt(e.email)&&(!this.personal_account||!("link"==Je?.currentRoute?.value?.name||this.account_doc?.personal_account&&this.account_doc?.linked_to)))return it.signOut(),new L.OO("Please use your MVLA email to log in, or use an account that has been linked",4e3),void this.clear();this.user=e,this.personal_account&&this.get_remote(),this.is_teacher&&(Ge.i2.log("🏫 In teacher mode"),this.teacher.doc_ref=(0,Qe.JU)(rt,"classes",this.user.email),this.teacher.collection_ref=(0,Qe.hJ)(this.teacher.doc_ref,"classes")),Je.currentRoute?.value?.query?.redirect&&!Je.currentRoute?.value?.meta?.blockStandardRedirect&&Je.replace(Je.currentRoute?.value?.query?.redirect)})).catch((e=>{it.signOut(),new L.OO("Something went wrong loading your user data",2e3),Ge.i2.log("🔥 Error loading user data: "+e)}))},async login(){new L.FN("Opening login popup...","default",1e3,o(1121)),await(gt||yt()?(0,tt.F6)(it,ft):(0,tt.rh)(it,ft)).then((()=>{if(this.user&&this.user.email&&wt(this.user.email))return new L.FN("Logged in as "+this.user.displayName+"!","default",2e3,o(8311)),Ge.i2.log("🔑 Logged in as "+this.user.displayName),dt(this.user),Je.currentRoute?.value?.query?.redirect||Je.currentRoute?.value?.meta?.blockStandardRedirect||Je.push("/portal"),Promise.resolve()})).catch((e=>{let t=(0,L.YY)(e);return"auth/cancelled-popup-request"==e.code||"auth/popup-closed-by-user"==e.code||"auth/user-cancelled"==e.code?new L.OO(t,2e3):new L.PK("Couldn't log in",t,2e3),Promise.reject(t)}))},async login_personal(){new L.FN("Opening login popup...","default",1e3,o(1121));const e=new tt.hJ;e.addScope("email"),e.addScope("profile"),await(gt||yt()?(0,tt.F6)(it,e):(0,tt.rh)(it,e)).then((e=>(e.user&&e.user.email&&!wt(e.user.email)||this.logout(),new L.FN("Logged in as "+e.user.displayName+"!","default",2e3,o(8311)),Ge.i2.log("🔑 Logged in as "+e.user.displayName),dt(e.user),Promise.resolve()))).catch((e=>(new L.PK("Couldn't log in",e,2e3),Promise.reject(e))))},async logout(){Je.currentRoute?.value?.meta?.requiresAuth&&await Je.push({path:"/"}),it.signOut(),this.clear(),new L.FN("Logged Out","default",1500,o(1121))},async get_remote(){let e=await(0,Qe.QT)(this.active_ref);Ge.i2.log("📄 Got user doc remote"),e.exists()?this.set_active(e.data()):this.personal_account?(Ge.i2.log("🔗 Linked account doesn't exist, removing it and going home"),new L.OO("Linked account doesn't exist, removing it and going home",2e3),this.account_doc.linked_to=null,await this.update_wrapper_acc_doc(),this.linked_account_doc=null,Je.push("/")):(await this.create_doc(),await this.get_remote())},async update_remote(){await(0,Qe.pl)(this.active_ref,this.active_doc,{merge:!0}),Ge.i2.log("⏶ Pushed changes to remote")},async update_wrapper_acc_doc(){await(0,Qe.pl)(this.account_ref,this.account_doc,{merge:!0})},async update_wrapper_with_merge(e){try{return await(0,Qe.pl)(this.account_ref,e,{merge:!0}),Promise.resolve()}catch(t){return Promise.reject(t)}},async create_doc(){Ge.i2.log("📄 User document doesn't exist, creating new one..."),new L.OO("User document doesn't exist, creating new one...",2e3),this.account_doc={name:this.user.displayName,email:this.user.email,classes:[],prefs:{theme:this.get_theme,hide_timeout:!1}},this.personal_account&&(this.account_doc={linked_to:null,personal_account:!0,name:this.user.displayName,email:this.user.email,prefs:{theme:this.get_theme,hide_timeout:!1}}),await this.update_wrapper_acc_doc(),new L.bF("Created user document; Let's get started",2e3),this.personal_account||Je.push({name:"portal"}),this.is_teacher&&(await this.create_teacher_doc(),new L.bF("Created user & teacher documents; Let's get started",2e3))},async create_teacher_doc(){let e=(0,Qe.JU)(rt,"classes",this.active_doc.email||this.user.email);await(0,Qe.pl)(e,{name:this.active_doc.name||this.user.displayName,email:this.active_doc.email||this.user.email}),this.teacher={doc_ref:e,collection_ref:(0,Qe.hJ)(e,"classes")},Je.push("/portal/create")},async fetch_classes(){let e=Math.random().toString(36).substring(7);if(Ge.i2.log(`📚 Started fetch   | <${e}>`),!this.active_doc?.classes){let e=0;const t=1e4,o=1500,s=100;while(!this.active_doc?.classes&&e<t/s)await new Promise((e=>setTimeout(e,s))),e++;if(!this.active_doc?.classes)return Promise.reject("Classes not found in user doc within load cycle");e*s>=o&&(Ge.i2.warn(`📚 Initial class fetch took ${e*s}ms, warning set at ${o}ms`),new L.OO(`Initial class fetch took ${e*s}ms. Your network connection may negativly affect site preformance.`,3500))}let t=[...new Set(this.active_doc.classes)];t.length!=this.active_doc.classes.length&&(this.personal_account?this.linked_account_doc.classes=t:this.account_doc.classes=t,await this.update_remote(),new L.OO("Removed duplicate classes",2e3),Ge.i2.log("📚 Removed duplicate classes"));let o=[];for(let s of this.active_doc.classes){let[e,t]=s.split("/");if(!e||!t){await this.remove_invalid(s);continue}let a=(0,Qe.hJ)(rt,"classes",e,"classes");if(!a){await this.remove_invalid(s);continue}let i=(0,Qe.JU)(a,t),r=await(0,Qe.QT)(i);if(!r.exists()){await this.remove_invalid(s);continue}let n=r.data();n.id=s,n.ref=[e,t].join("/"),o.push(n)}Ge.i2.log(`📚 Got class docs  | <${e}>`),o=o.map((e=>{let[t,o]=e.ref.split("/");return e.tasks=e.tasks||[],e.tasks=e.tasks.map((e=>(e.ref=[t,o,e.id].join("/"),delete e.id,e))),e})),Ge.i2.log(`📚 Processed tasks | <${e}>`),o.sort(((e,t)=>e.period==t.period?e.name.localeCompare(t.name):e.period||0===e.period?t.period||0===t.period?e.period-t.period:-1:1)),this.classes=o,this.get_tasks(),Promise.resolve()},async fetch_classes_by_email(e){if(this.loaded_email=null,!e||!wt(e))return this.loaded_classes=null,void(this.loaded_email=e);Ge.i2.log("📄 Getting classes from email");let t=[],o=(0,Qe.hJ)((0,Qe.JU)(rt,"classes",e),"classes"),s=await(0,Qe.PL)(o);Ge.i2.log("📄 Got classes subcollection from email"),s.forEach((o=>{let s=o.data();s.id=o.id,s.is_joined=this.active_doc?.classes.includes([e,o.id].join("/")),t.push(s)})),t.sort(((e,t)=>e.period==t.period?e.name.localeCompare(t.name):e.period-t.period)),this.loaded_classes=t,this.loaded_email=e},async add_class(e,t,o,s){if(!this.active_doc?.classes)return;if(!t)return;let a=[e,t].join("/");return this.active_doc.classes.includes(a)?void 0:(this.personal_account?this.linked_account_doc.classes.push(a):this.account_doc.classes.push(a),await this.update_remote(),await this.fetch_classes(),new L.bF(`Added "${this.class_text({name:o,period:s})}" to your classes`,2e3),Promise.resolve())},async create_class(e){if(Ge.i2.log("🔨 Creating class",e),this.is_teacher){if(e.name)try{if(!this.teacher.doc_ref||!this.teacher.collection_ref)return await this.create_teacher_doc(),void await this.create_class(e);let t=await(0,Qe.ET)(this.teacher.collection_ref,e);return new L.bF(`Created class "${this.class_text(e)}"`,2e3),Ge.i2.log("🏫 class_doc_ref",t),await this.add_class(this.active_doc.email||this.user.email,t.id,e.name,e.period),Promise.resolve()}catch(t){return new L.PK("Couldn't create class",(0,L.YY)(t),2e3),Promise.reject(t)}}else new L.OO("You need to be a teacher to create a class",2e3)},async create_task(e,t){try{if(!e.name&&"note"!=e?.type)return Promise.reject("No task name specified");if(!t||0==t.length)return Promise.reject("No classes selected");let o=(0,Qe.qs)(rt),s=Array.from(this.classes);t.forEach((t=>{let a=t,[i,r]=t.split("/"),n=(0,Qe.hJ)(rt,"classes",i,"classes",r,"tasks");e.class_id=a;let l=(0,Qe.JU)(n);o.set(l,e),s.forEach((t=>{t.id==a&&t.tasks.push({...e,ref:[i,r,l.id].join("/"),class_id:a,_proxy:!0})}))})),await o.commit(),this.classes=s,this.get_tasks();let a="note"==e.type?"":`"${e.name}"`;return new L.bF(`Added ${e.type||"task"} ${a} to ${t.length} class${1==t.length?"":"es"}`,2e3),Promise.resolve()}catch(o){return Promise.reject(o)}},async update_class(e,t){try{let[o,s]=e.split("/");o+=this.ORG_DOMAIN,await(0,Qe.r7)((0,Qe.JU)(rt,"classes",o,"classes",s),t),Ge.i2.log("📝 Updated remote class");let a=this.classes;const i=a.findIndex((e=>e.id===[o,s].join("/")));return-1!==i&&(a[i]={...a[i],...t,_proxy:!0},Ge.i2.log("📝 Updated local class")),this.classes=[...a],this.get_tasks(),Promise.resolve()}catch(o){return Promise.reject(o)}},async update_task(e,t){try{delete t.class_id,delete t.ref,delete t._class;let[o,s,a]=e.split("/");o.includes(this.ORG_DOMAIN)||(o+=this.ORG_DOMAIN),await(0,Qe.r7)((0,Qe.JU)(rt,"classes",o,"classes",s,"tasks",a),t),Ge.i2.log("📝 Updated remote task");let i=this.classes,r=[o,s].join("/");const n=i.findIndex((e=>e.id===r)),l=[o,s,a].join("/");if(-1!==n){const e=i[n].tasks.findIndex((e=>e.ref===l));-1!==e&&(i[n].tasks[e]={...t,ref:l,class_id:r,_proxy:!0},Ge.i2.log("📝 Updated local task"))}return this.classes=[...i],this.get_tasks(),Promise.resolve()}catch(o){return Promise.reject(o)}},async archive_task(e){let[t,o,s]=e.split("/");t+=this.ORG_DOMAIN;try{await(0,Qe.oe)((0,Qe.JU)(rt,"classes",t,"classes",o,"tasks",s)),Ge.i2.log("📄 Archived task");try{let e=this.classes;e.forEach((e=>{e.id==[t,o].join("/")&&(e.tasks=e.tasks.filter((e=>e.ref!=[t,o,s].join("/"))))})),this.classes=e,this.get_tasks()}catch(a){throw Ge.i2.error("🔥 Error removing task from local",a),a}}catch(a){return Promise.reject(a)}return Promise.resolve()},async task_from_ref(e){try{let[t,o,s]=e.split("/");t+=this.ORG_DOMAIN;let a=await(0,Qe.QT)((0,Qe.JU)(rt,"classes",t,"classes",o));if(!a.exists())return Promise.resolve(null);let i=a.data();delete i.tasks,Ge.i2.log("📚 Got class from ref");let r=await(0,Qe.QT)((0,Qe.JU)(rt,"classes",t,"classes",o,"tasks",s));if(!r.exists())return Promise.resolve(null);Ge.i2.log("📄 Got task from ref");let n=r.data();return n={...n,ref:e,class_id:[t,o].join("/"),class_name:this.class_text(i),_class:{...i,ref:[t.split(this.ORG_DOMAIN)[0],o].join("~")}},Promise.resolve(n)}catch(t){return Promise.reject(t)}},async class_from_ref(e,t=!1){try{let[o,s]=e.split("/");o+=this.ORG_DOMAIN;let a=await(0,Qe.QT)((0,Qe.JU)(rt,"classes",o,"classes",s));if(Ge.i2.log("📄 Got class doc"),!a.exists())return Promise.reject("Class doesn't exist");let i=a.data();return t||delete i.tasks,Ge.i2.log("📚 Got class data"),Promise.resolve(i)}catch(o){return Promise.reject(o)}},async upcoming_from_ref(e,t){try{if(!e)throw"No class ref provided";t||(t=await this.class_from_ref(e));let[o,s]=e.split("/");o+=this.ORG_DOMAIN;let a=await(0,Qe.QT)((0,Qe.JU)(rt,"classes",o,"classes",s));if(!a.exists())throw"Class doesn't exist";let i=a.data()?.tasks||[];i=i.filter((e=>"note"!=e.type&&(0,Ge.HU)(e.date).getTime()>=(new Date).getTime())),i.sort(((e,t)=>(0,Ge.HU)(e.date).getTime()-(0,Ge.HU)(t.date).getTime())),i=i.slice(0,6);let r=[];return i.forEach((a=>{let i=a.id;delete a.id,r.push({...a,ref:[...e.split("/"),i].join("~"),date:(0,Ge.HU)(a.date),color:t.color,class_id:[o,s].join("/"),class_name:this.class_text(t)})})),Ge.i2.log("📚 Got upcoming tasks"),Promise.resolve(r)}catch(o){return Promise.reject(o)}},show_timeout(){Ge.i2.log("🕒 Showing timeout"+(this.account_doc?.prefs?.hide_timeout?" | Hidden locally due to prefs":"")),this.paused=!0},hide_timeout(){this.paused&&(this.account_doc?.prefs?.hide_timeout||Ge.i2.log("🕒 Hiding timeout"),this.paused=!1)}}});function xt(e){if(e)return e=e.replace(" or ",", "),e.split(", ").map((e=>(e=e.replace("Control","Ctrl"),-1!=navigator?.userAgent.indexOf("Mac OS X")&&(e=e.replace("Ctrl","⌘"),e=e.replace("Meta","⌘"),e=e.replace("Shift","⇧"),e=e.replace("Alt","⌥"),e=e.replace("Escape","esc"),e=e.replace("Home","fn + ←"),e=e.replace("End","fn + →")),e=e.replace("ArrowUp","↑"),e=e.replace("ArrowDown","↓"),e=e.replace("ArrowLeft","←"),e=e.replace("ArrowRight","→"),e=e.replace("Enter","⏎"),e=e.replace("Escape","Esc"),e=e.replace("Backspace","⌫"),e=e.replace("Delete","⌦"),e=e.replace("Tab","⇥"),e)))}const Pt=(0,i.Q_)({id:"shortcuts",state:()=>({shortcuts:[],keys:[],active:{}}),getters:{get(e){return this.shortcuts.find((t=>t===e))},get_key(e){if(this.keys.includes(e))return this.shortcuts.find((t=>t.key===e))},list(){return this.shortcuts.map((e=>({...e,keys:xt(e.key)})))},sections(){let e=[],t=this.shortcuts.map((e=>e.tag));t=[...new Set(t)];for(let o=0;o<t.length;o++)e.push({tag:t[o],list:this.list.filter((e=>e.tag===t[o]))});return e}},actions:{register(e,t=!1){e?.key&&e?.description?(this.keys.includes(e.key)&&Ge.i2.warn(`⌨️ Shortcut key "${e.key}" already registered`),this.keys.push(e.key),this.shortcuts.push(e),t||this.sort()):Ge.i2.error("⌨️ Shortcut must have key and description text")},register_all(e,t){for(let o=0;o<e.length;o++)this.register({...e[o],tag:t},!0);this.sort()},remove(e){this.shortcuts.includes(e)?this.shortcuts.splice(this.shortcuts.indexOf(e),1):Ge.i2.error("⌨️ Shortcut not registered, cannot remove",e)},remove_all(e,t){for(let o=0;o<e.length;o++)this.remove({...e[o],tag:t})},remove_tag(e){this.shortcuts=this.shortcuts.filter((t=>t.tag!==e)),this.keys=this.shortcuts.map((e=>e.key))},remove_key(e){this.keys.includes(e)?(this.keys.splice(this.keys.indexOf(e),1),this.shortcuts.splice(this.shortcuts.indexOf(this.get_key(e)),1)):Ge.i2.error(`⌨️ Key "${e}" not registered, cannot remove shortcut`)},remove_keys(e){for(let t=0;t<e.length;t++)this.remove_key(e[t])},sort(){this.shortcuts.sort(((e,t)=>e.tag!==t.tag?"General"!==e.tag&&t.tag?"General"!==t.tag&&e.tag?e.tag.localeCompare(t.tag):1:-1:e.top&&!t.top?-1:!e.top&&t.top?1:e.key!==t.key?e.key.localeCompare(t.key):e.description.localeCompare(t.description)))},clear(){this.shortcuts=[],this.keys=[],Ge.i2.log("⌨️ Cleared shortcuts")},set_activity(e,t){this.active[t]=e},is_active(e){return this.active[e]}}}),Tt="https://api.mvtt.app/",At=(0,i.Q_)({id:"magic",state:()=>({last:{},types:[{key:"note",name:"Note",list_as:"Add a Note",shortcuts:["n"]},{key:"task",name:"Assignment",list_as:"Schedule an Assignment",shortcuts:["a"]},{key:"test",name:"Test",list_as:"Schedule a Test",shortcuts:["t"]},{key:"project",name:"Project",list_as:"Schedule a Project",shortcuts:["p"]},{key:"quiz",name:"Quiz",list_as:"Schedule a Quiz",shortcuts:["q"]},{key:"exam",name:"Exam",list_as:"Schedule an Exam",shortcuts:["e"]}]}),getters:{},actions:{type_full(e){return this.types.find((t=>t.key===e))?.name||e},async text(e){if(e)return await this.rated_api_get("get/magic/link-text",{path:e})},async type(e){if(e)return await this.rated_api_get("get/magic/task-type",{task:e})},async api_get(e,t){if(t=t||{},!e)return;const o=new URL(Tt+e);Object.keys(t).forEach((e=>o.searchParams.append(e,t[e])));const s=Math.random().toString(36).substring(7);Ge.i2.log(`🛜 Running API fetch | <${s}>`),this.last[e]={time:Date.now(),hash:s};try{const e=await fetch(o.href,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw"Non-valid response";const t=await e.json();return Ge.i2.log(`🛜 API fetch success | <${s}>`),t.data}catch(a){return Ge.i2.error(`🛜 API fetch failed  | <${s}>`,a),null}},async rated_api_get(e){Ge.i2.log("🛜 API fetch requested");const t=Math.random().toString(36).substring(7),o=this.last[e]?.time,s=this.last[e]?.hash;if(Date.now()-o<2e3){if(Ge.i2.warn("🛜 API fetch rate limited"),await new Promise((e=>setTimeout(e,15e3))),this.last[e]?.time!==o||this.last[e]?.hash!==s)return void Ge.i2.warn("🛜 Outdated API fetch skipped");Ge.i2.log("🛜 API fetch rate limit lifted")}return await this.api_get(...arguments,t)}}}),Ct=(0,i.WB)(),$t=(0,s.ri)(oe);$t.use(Je),$t.use(Ct),$t.mixin({computed:{$env(){return{NODE_ENV:"production",VUE_APP_BRAND_LONG_NAME:"MV Test Tracker",VUE_APP_BRAND_SHORT_NAME:"MVTT",VUE_APP_BRAND_URL:"https://mvtt.app",VUE_APP_BRAND_HOMEPAGE:"http://mvtt.app",VUE_APP_BRAND_DOMAIN:"mvtt.app",VUE_APP_BRAND_DOMAIN__API:"api.mvtt.app",VUE_APP_BRAND_DOMAIN__VIEWCLASS:"view.mvtt.app",VUE_APP_BRAND_DOMAIN__VIEWTASK:"view.mvtt.app",VUE_APP_BRAND_MAIL_ADDRESS:"mail@mvtt.app",BASE_URL:"/"}},$status(){return Ge.i2},$store(){return bt()},$shortcuts(){return Pt()},$magic(){return At()}}}),$t.use(ze()),$t.use(Ye.Z,{preLoad:2,attempt:1}),$t.mount("#app"),(0,a.YP)(Ct.state,(e=>{window.localStorage.setItem("MVTT_app_state",JSON.stringify(e.main))}),{deep:!0}),window.addEventListener("storage",(e=>{"MVTT_teacher_mode"===e.key&&(Ge.i2.log("🏫 Detected teacher mode change, reloading"),window.location.reload())})),I()(document.body).on("click",".auth-action",(function(){const e=bt();!e.user&&I()(this).hasClass("can-login")?e.login():I()(this).hasClass("can-logout")&&(I()(this).hasClass("doprompt")?e.logout_prompt=!0:e.logout())})),I()(document.body).on("click",".gohome",(function(){Je.push("/")})),Je.afterEach((e=>{e.meta&&e.meta.page_title?document.title="MV Test Tracker | "+e.meta.page_title:document.title="MV Test Tracker";let t=e.meta?.theme_color?.light||"#f5c14b",o=e.meta?.theme_color?.dark||"#f5c14b";I()("meta.theme-color").attr("content",t),I()("meta.theme-color-dark").attr("content",o),(0,L.hC)();const s=document.documentElement.style;s.setProperty("--theme-color",t),s.setProperty("--theme-color-dark",o);let a=e.meta?.theme_color?.text_light||"#000000",i=e.meta?.theme_color?.text_dark||"#ffffff";s.setProperty("--theme-color-text",a),s.setProperty("--theme-color-text-dark",i),s.setProperty("--theme-color-hover",a+"33"),s.setProperty("--theme-color-hover-dark",i+"33")})),window.toast=L.gy,window.$=I(),Je.beforeEach((e=>{const t=bt();return e.meta&&e.meta.requiresAuth&&t&&!t.user?(new L.FN("Please log in or join to access this page","default",1500,o(1121)),{path:"/",query:{redirect:e.fullPath}}):e.meta&&e.meta.requiresTeacher&&t.user&&!t.is_teacher?(new L.FN("You must be a teacher to access this page","default",1500,o(1121)),{name:"portal"}):void 0}))},4884:function(e,t,o){"use strict";o.d(t,{Z:function(){return b}});var s=o(3396),a=o(7139);const i=e=>((0,s.dD)("data-v-793cb3ff"),e=e(),(0,s.Cn)(),e),r={class:"modal",ref:"modal"},n={key:0,class:"modal_header",ref:"title"},l={class:"header_style modal_header_title"},c={key:1,ref:"contents",class:"overlay_contents"},d=["innerHTML"],u={class:"bottom_actions"},h={key:1,class:"progress_display"},m=["onClick"],_=i((()=>(0,s._)("div",{class:"flex_spacer"},null,-1))),p=["disabled"];function f(e,t,o,i,f,g){return(0,s.wg)(),(0,s.iD)("main",r,[o.title?((0,s.wg)(),(0,s.iD)("header",n,[(0,s._)("h2",l,(0,a.zw)(o.title),1)],512)):(0,s.kq)("",!0),o.content||o.html?((0,s.wg)(),(0,s.iD)("div",c,[((0,s.wg)(),(0,s.j4)((0,s.LL)(o.content),{ref:"container",onUpdate:t[0]||(t[0]=t=>e.$emit("update",t)),onStatus:t[1]||(t[1]=t=>e.$emit("status",t)),onSkip:t[2]||(t[2]=t=>e.$emit("skip")),load:o.load},null,40,["load"])),o.html?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"overlay_contents__html",innerHTML:o.html},null,8,d)):(0,s.kq)("",!0)],512)):(0,s.kq)("",!0),(0,s._)("div",u,[o.skippable?((0,s.wg)(),(0,s.iD)("button",{key:0,class:"close_action click_escape",onClick:t[3]||(t[3]=t=>e.$emit("skip"))},(0,a.zw)(o.skip_text||(o.progress&&o.progress.current>1?"Abandon":"Close")),1)):(0,s.kq)("",!0),o.progress&&o.progress.total>1?((0,s.wg)(),(0,s.iD)("div",h,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.progress.total,(t=>((0,s.wg)(),(0,s.iD)("span",{class:"progress_display__dot_container",key:t,onClick:o=>e.$emit("open",t-1)},[(0,s._)("span",{class:(0,a.C_)(["progress_display__dot",{dot_active:t==o.progress.current,dot_finished:t<o.progress.current}])},null,2)],8,m)))),128))])):(0,s.kq)("",!0),_,(0,s._)("button",{class:"continue_action click_ctrlenter",onClick:t[4]||(t[4]=(...e)=>o.continue_action&&o.continue_action(...e)),disabled:!o.can_continue},(0,a.zw)(g.button_text),9,p)])],512)}o(7658);var g=o(9529),k=o.n(g),w={name:"ModalVue",mixins:[k()],mounted(){this.$smoothReflow({el:this.$refs.contents,hideOverflow:!0,childTransitions:!0}),this.$smoothReflow({el:this.$refs.title,hideOverflow:!0})},emits:["open","update","status","skip"],data(){return{}},props:{load:{type:Object,default:()=>({})},skippable:{type:Boolean,default:!1,required:!1},title:{type:String,default:"",required:!1},content:{type:Object,default:null,required:!1},html:{type:String,default:null,required:!1},can_continue:{type:Boolean,required:!0},continue_action:{type:Function,default:()=>{(void 0).$status.log("⏵ ModalVue: continue_action not provided"),window.onbeforeunload=null,(void 0).$router.push((void 0).$route.query.redirect||{name:"portal",query:(void 0).$route.query})},required:!1},progress:{type:Object,default:null,required:!1},is_notification:{type:Boolean,default:!1,required:!1},submit_text:{type:String,required:!1},skip_text:{type:String,required:!1}},computed:{button_text(){return this.submit_text?this.submit_text:this.is_notification?"Ok":this.progress&&this.progress.current==this.progress.total?"Finish":"Continue"}}},y=o(89);const v=(0,y.Z)(w,[["render",f],["__scopeId","data-v-793cb3ff"]]);var b=v},3917:function(e,t,o){"use strict";o.d(t,{Z:function(){return d}});var s=o(3396),a=o(7139);const i=["closable"];function r(e,t,o,r,n,l){return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)(["overlay overlay_center_view overlay_slot__wrapper",{animate_out:n.animating_out}])},[(0,s._)("div",{class:"overlay_close",onClick:t[0]||(t[0]=e=>l.closable?l.close():null),closable:l.closable},null,8,i),o.component?((0,s.wg)(),(0,s.j4)((0,s.LL)(o.component),{key:0,class:"overlay_slot",onClose:l.close},null,40,["onClose"])):(0,s.WI)(e.$slots,"default",{key:1,class:"overlay_slot",close:l.close})],2)}var n={name:"OverlayWrapper",emits:["close"],props:{component:{type:Object,default:null}},data(){return{animating_out:!1}},computed:{closable(){return!0!==this.$route?.meta?.block_close}},methods:{close(){this.animating_out=!0,setTimeout((()=>{window.onbeforeunload=null,this.$emit("close"),this.animating_out=!1}),250)}}},l=o(89);const c=(0,l.Z)(n,[["render",r]]);var d=c},2480:function(){},4654:function(){}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,o),i.exports}o.m=e,function(){var e=[];o.O=function(t,s,a,i){if(!s){var r=1/0;for(d=0;d<e.length;d++){s=e[d][0],a=e[d][1],i=e[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&i||r>=i)&&Object.keys(o.O).every((function(e){return o.O[e](s[l])}))?s.splice(l--,1):(n=!1,i<r&&(r=i));if(n){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[s,a,i]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,s){return o.f[s](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/"+e+"."+{34:"a8866e2e",50:"9e152963",65:"34d7c6f8",251:"c76c6a6e",261:"bad6d634",265:"63681129",274:"d886ee58",350:"028a357e",385:"fcb1cb7e",390:"78d2d2ff",391:"7b479a95",395:"3ddf67e6",478:"2fedf6cb",490:"26a8b35a",496:"ddd51380",533:"4988216e",543:"f7adb4bf",552:"767be91f",557:"e10bf83d",682:"e950bbbd",755:"50ca2b52",780:"2e097506",781:"a144e10a",782:"8cfce1da",790:"cfb598b1",838:"82eb56b9",862:"88a3fbb7",877:"4c68f2ee"}[e]+".js"}}(),function(){o.miniCssF=function(e){return"css/"+e+"."+{34:"070f04ad",50:"9e20b7b5",65:"e7ab6830",251:"1541a665",261:"6fb3ed98",265:"55d81a3c",350:"5a81cdc9",385:"9d0f9d59",390:"e7cd22dc",395:"fb57c3bd",490:"5794e1a4",496:"ae8d6e0a",533:"6b5f4ebf",543:"79fe6def",552:"12dd8497",557:"2423903e",682:"7c9c1a8a",755:"834c139e",780:"6b02227c",781:"61dcd1ec",782:"e2d5d4a1",790:"fe38d711",838:"ca8b15ce",862:"02f180f6",877:"eb22db69"}[e]+".css"}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="mvtime:";o.l=function(s,a,i,r){if(e[s])e[s].push(a);else{var n,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+i){n=u;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,o.nc&&n.setAttribute("nonce",o.nc),n.setAttribute("data-webpack",t+i),n.src=s),e[s]=[a];var h=function(t,o){n.onerror=n.onload=null,clearTimeout(m);var a=e[s];if(delete e[s],n.parentNode&&n.parentNode.removeChild(n),a&&a.forEach((function(e){return e(o)})),t)return t(o)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=h.bind(null,n.onerror),n.onload=h.bind(null,n.onload),l&&document.head.appendChild(n)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,o,s,a){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var r=function(o){if(i.onerror=i.onload=null,"load"===o.type)s();else{var r=o&&("load"===o.type?"missing":o.type),n=o&&o.target&&o.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=r,l.request=n,i.parentNode&&i.parentNode.removeChild(i),a(l)}};return i.onerror=i.onload=r,i.href=t,o?o.parentNode.insertBefore(i,o.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var o=document.getElementsByTagName("link"),s=0;s<o.length;s++){var a=o[s],i=a.getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(i===e||i===t))return a}var r=document.getElementsByTagName("style");for(s=0;s<r.length;s++){a=r[s],i=a.getAttribute("data-href");if(i===e||i===t)return a}},s=function(s){return new Promise((function(a,i){var r=o.miniCssF(s),n=o.p+r;if(t(r,n))return a();e(s,n,null,a,i)}))},a={143:0};o.f.miniCss=function(e,t){var o={34:1,50:1,65:1,251:1,261:1,265:1,350:1,385:1,390:1,395:1,490:1,496:1,533:1,543:1,552:1,557:1,682:1,755:1,780:1,781:1,782:1,790:1,838:1,862:1,877:1};a[e]?t.push(a[e]):0!==a[e]&&o[e]&&t.push(a[e]=s(e).then((function(){a[e]=0}),(function(t){throw delete a[e],t})))}}}(),function(){var e={143:0};o.f.j=function(t,s){var a=o.o(e,t)?e[t]:void 0;if(0!==a)if(a)s.push(a[2]);else{var i=new Promise((function(o,s){a=e[t]=[o,s]}));s.push(a[2]=i);var r=o.p+o.u(t),n=new Error,l=function(s){if(o.o(e,t)&&(a=e[t],0!==a&&(e[t]=void 0),a)){var i=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;n.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",n.name="ChunkLoadError",n.type=i,n.request=r,a[1](n)}};o.l(r,l,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,s){var a,i,r=s[0],n=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(a in n)o.o(n,a)&&(o.m[a]=n[a]);if(l)var d=l(o)}for(t&&t(s);c<r.length;c++)i=r[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(d)},s=self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=o.O(void 0,[998],(function(){return o(343)}));s=o.O(s)})();
//# sourceMappingURL=app.7edc491a.js.map