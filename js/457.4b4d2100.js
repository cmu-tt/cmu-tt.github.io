"use strict";(self["webpackChunkmvtime"]=self["webpackChunkmvtime"]||[]).push([[457],{1311:function(t,e,s){s.d(e,{l:function(){return l}});var a=s(2745),i=s(1020);const n="https://api.mvtt.app/",l=(0,i.Q_)({id:"magic",state:()=>({last:{},types:[{key:"note",name:"Note",list_as:"Add a Note",shortcuts:["n"]},{key:"task",name:"Assignment",list_as:"Schedule an Assignment",shortcuts:["a"]},{key:"test",name:"Test",list_as:"Schedule a Test",shortcuts:["t"]},{key:"project",name:"Project",list_as:"Schedule a Project",shortcuts:["p"]},{key:"quiz",name:"Quiz",list_as:"Schedule a Quiz",shortcuts:["q"]},{key:"exam",name:"Exam",list_as:"Schedule an Exam",shortcuts:["e"]}]}),getters:{},actions:{type_full(t){return this.types.find((e=>e.key===t))?.name||t},async text(t){if(t)return await this.rated_api_get("get/magic/link-text",{path:t})},async type(t){if(t)return await this.rated_api_get("get/magic/task-type",{task:t})},async api_get(t,e){if(e=e||{},!t)return;const s=new URL(n+t);Object.keys(e).forEach((t=>s.searchParams.append(t,e[t])));const i=Math.random().toString(36).substring(7);a.i2.log(`🛜 Running API fetch | <${i}>`),this.last[t]={time:Date.now(),hash:i};try{const t=await fetch(s.href,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw"Non-valid response";const e=await t.json();return a.i2.log(`🛜 API fetch success | <${i}>`),e.data}catch(l){return a.i2.error(`🛜 API fetch failed  | <${i}>`,l),null}},async rated_api_get(t){a.i2.log("🛜 API fetch requested");const e=Math.random().toString(36).substring(7),s=this.last[t]?.time,i=this.last[t]?.hash;if(Date.now()-s<2e3){if(a.i2.warn("🛜 API fetch rate limited"),await new Promise((t=>setTimeout(t,15e3))),this.last[t]?.time!==s||this.last[t]?.hash!==i)return void a.i2.warn("🛜 Outdated API fetch skipped");a.i2.log("🛜 API fetch rate limit lifted")}return await this.api_get(...arguments,e)}}})},457:function(t,e,s){s.r(e),s.d(e,{default:function(){return Y}});var a=s(3396),i=s(7139),n=s(9242);const l=t=>((0,a.dD)("data-v-0ba447cc"),t=t(),(0,a.Cn)(),t),d={class:"create_task"},o={class:"modal_header"},r={class:"header_style modal_header_title"},c=["value"],h=["disabled"],_={class:"overlay_contents",ref:"contents"},p={class:"overlay_contents_text"},k={key:0},u={key:1},y={class:"inputs_row"},w=["placeholder","disabled"],m=l((()=>(0,a._)("div",{class:"flex-break"},null,-1))),g=["placeholder"],f=l((()=>(0,a._)("div",{class:"flex-break"},null,-1))),x={class:"styled_input styled_links_box"},b={class:"styled_links_display"},v={key:0,class:"placeholder"},$={key:1,class:"styled_line_links"},C=["onClick"],D=l((()=>(0,a._)("hr",{class:"styled_links_separator"},null,-1))),P={class:"magic_wrapper styled_links_add__sized"},A=["disabled"],z=["disabled"],U={class:"overlay_contents_text"},O={class:"classes_checkboxes checkboxes"},q=["href"],S=["id","value"],L=["for"],j=["for"],I={class:"bottom_actions"},T=l((()=>(0,a._)("div",{class:"flex_spacer"},null,-1))),V=["disabled"];function K(t,e,s,l,K,R){return(0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("header",o,[(0,a._)("h2",r,[(0,a._)("span",null,"Add a"+(0,i.zw)(R.is_vowel(R.type_full[0])?"n":"")+" ",1),(0,a._)("div",{class:(0,i.C_)(["header_magic_wrapper magic_wrapper contents_inherit",{magic_ready:R.type_ready}])},[(0,a.wy)((0,a._)("select",{title:"Task type","onUpdate:modelValue":e[0]||(e[0]=t=>K.task.type=t),class:"type_dropdown styled_input styled_select",ref:"type"},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(R.magic.types,(t=>((0,a.wg)(),(0,a.iD)("option",{class:"type_dropdown__option styled_select__option",value:t.key,key:t.key},(0,i.zw)(t.name),9,c)))),128))],512),[[n.bM,K.task.type]]),(0,a._)("div",{class:(0,i.C_)(["magic magic_in styled_magic alt_bg click-action",{magic_out:!R.type_ready,loading_bg:K.loading_type}]),disabled:!R.type_ready||K.loading_type,onClick:e[1]||(e[1]=(...t)=>R.magic_type&&R.magic_type(...t)),title:"Use magically inferred type"},null,10,h)],2)])]),(0,a._)("div",_,[(0,a._)("div",p,[R.is_note?((0,a.wg)(),(0,a.iD)("span",k,"Add a new "+(0,i.zw)(K.task.type)+" to",1)):((0,a.wg)(),(0,a.iD)("span",u,"Schedule a new "+(0,i.zw)(K.task.type)+" for",1)),(0,a.Uk)(" your class"+(0,i.zw)(R.classes&&1==R.classes.length?"":"es"),1)]),(0,a._)("div",y,[R.is_note?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.iD)("input",{key:0,"onUpdate:modelValue":e[2]||(e[2]=t=>K.task.name=t),class:"styled_input",type:"text",placeholder:R.type_full+" Name",disabled:R.is_note},null,8,w)),[[n.nr,K.task.name]]),(0,a.wy)((0,a._)("input",{type:"date",ref:"date",class:"styled_input input_task__date","onUpdate:modelValue":e[3]||(e[3]=t=>K.task.date=t),style:(0,i.j5)({maxWidth:R.is_note?"100%":null})},null,4),[[n.nr,K.task.date]]),m,(0,a.wy)((0,a._)("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>K.task.description=t),class:"styled_input styled_textarea task_description",type:"text",placeholder:R.type_full+(R.is_note?" Contents":" Description (Optional)")},"\n        ",8,g),[[n.nr,K.task.description]]),f,(0,a._)("div",x,[(0,a._)("div",b,[K.task.links&&K.task.links.length?((0,a.wg)(),(0,a.iD)("div",$,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(K.task.links,(t=>((0,a.wg)(),(0,a.iD)("a",{class:"styled_line_links__link styled_line_links__remove",target:"_blank",key:t.path,onClick:e=>R.remove_link(t)},(0,i.zw)(t.text),9,C)))),128))])):((0,a.wg)(),(0,a.iD)("span",v,(0,i.zw)(R.type_full)+" Links (Optional)",1))]),D,(0,a._)("div",{class:"styled_links_add",onKeydown:e[10]||(e[10]=t=>{"Enter"===t.key&&(t.preventDefault(),R.add_newlink())})},[(0,a.wy)((0,a._)("input",{class:"styled_links_add__path",type:"url","onUpdate:modelValue":e[5]||(e[5]=t=>K.newlink.path=t),onBlur:e[6]||(e[6]=(...t)=>R.fix_newlink_path&&R.fix_newlink_path(...t)),placeholder:"Link URL (https://example.com)"},null,544),[[n.nr,K.newlink.path]]),(0,a._)("div",P,[(0,a.wy)((0,a._)("input",{class:"styled_links_add__text",type:"text","onUpdate:modelValue":e[7]||(e[7]=t=>K.newlink.text=t),placeholder:"Link Text (what students see)"},null,512),[[n.nr,K.newlink.text]]),(0,a._)("div",{class:(0,i.C_)(["magic magic_in styled_magic alt_bg click-action",{magic_out:!R.path_ready,loading_bg:K.loading_text}]),disabled:!R.path_ready||K.loading_text,onClick:e[8]||(e[8]=(...t)=>R.magic_text&&R.magic_text(...t)),title:"Auto-generate link text"},null,10,A)]),(0,a._)("button",{class:"styled_links_add__action",onClick:e[9]||(e[9]=(...t)=>R.add_newlink&&R.add_newlink(...t)),disabled:R.newlink_not_ready}," Add ",8,z)],32)])]),(0,a._)("div",U," Choose which classes this "+(0,i.zw)(K.task.type)+" will be added to ",1),(0,a._)("div",O,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(R.classes,(s=>((0,a.wg)(),(0,a.iD)("a",{class:"checkbox",key:s.id,href:"/view/"+R.store.path_to_ref(s.ref)},[(0,a.wy)((0,a._)("input",{type:"checkbox",id:s.id,value:s.id,"onUpdate:modelValue":e[11]||(e[11]=t=>K.task_classes=t)},null,8,S),[[n.e8,K.task_classes]]),s.id?((0,a.wg)(),(0,a.iD)("label",{key:0,class:"button_pointer_text class_name",for:s.id,style:(0,i.j5)({"--color-class":s.color,"--color-class-alt":s.color+"2d"})},(0,i.zw)(R.store.class_text(s)),13,L)):((0,a.wg)(),(0,a.iD)("label",{key:1,for:s.id,onClick:e[12]||(e[12]=(...e)=>t.$event.stopPropagation&&t.$event.stopPropagation(...e))},(0,i.zw)(s.name),9,j))],8,q)))),128))])],512),(0,a._)("div",I,[(0,a._)("button",{class:"close_action click_escape",onClick:e[13]||(e[13]=e=>t.$emit("close"))},"Close"),T,(0,a._)("button",{class:(0,i.C_)(["continue_action click_ctrlenter",{loading_bg:K.loading}]),onClick:e[14]||(e[14]=(...t)=>R.try_submit&&R.try_submit(...t)),disabled:!R.ready}," Add "+(0,i.zw)(K.task.type),11,V)])])}s(7658);var R=s(8980),E=s(1311),G=s(1708),N=s(9529),F=s.n(N),H={name:"CreateTaskView",emits:["close"],mixins:[F()],mounted(){this.$smoothReflow({el:this.$refs.contents}),this.$route?.params?.tasktype?this.$refs.date.focus():this.$refs.type.focus(),this.$router.replace({...this.$route,query:{...this.$route.query,class:void 0,date:void 0}})},data(){return{task:{name:"",date:this.$route.query?.date?this.$route.query.date:"",description:"",type:this.$route.params.tasktype?this.$route.params.tasktype:"task"},task_classes:this.$route.query?.class?[this.$route.query.class]:[],newlink:{text:"",path:""},loading:!1,loading_type:!1,loading_text:!1,loaded_type:!1,loaded_text:!1}},computed:{ready(){return(this.task.name||this.is_note)&&this.task.date&&this.task_classes.length&&(!this.is_note||this.task.description)},type_full(){return this.magic.type_full(this.task.type)},newlink_not_ready(){if(!this.newlink.path||!this.newlink.text)return!0;try{return new URL(this.newlink.path),!1}catch(t){return!0}},class_name(){if(!this.classes)return null;let t=this.classes.find((t=>t.id===this.class_id));return t?t.name:null},store(){return(0,R.h)()},magic(){return(0,E.l)()},classes(){return this.store.classes},is_note(){return"note"===this.task.type},type_ready(){return!this.loaded_type&&this.task&&(this.task.description||this.task.name).length>5},path_ready(){return!this.loaded_text&&this.newlink.path&&this.newlink_not_ready&&this.newlink.path.startsWith("https://")}},methods:{try_submit(){this.ready?this.create_task():new G.OO("Please fill out all required fields",1e3)},is_vowel(t){return["a","e","i","o","u"].includes(t.toLowerCase())},add_newlink(){this.task.links||(this.task.links=[]),this.newlink.path=new URL(this.newlink.path).href,this.task.links.push(this.newlink),this.newlink={text:"",path:""}},create_task(){this.newlink_not_ready?(this.loading=!0,this.store.create_task(this.task,this.task_classes).then((()=>{
//! router to new task view?
this.$emit("close")})).catch((t=>{this.loading=!1,this.$status.error(`📃 Couldn't create ${this.task.type||"task"}:`,t),new G.PK("Couldn't create task",t,2e3)}))):new G.OO("Don't forget to to click the 'Add' button to add your link!",2e3)},remove_link(t){this.task.links=this.task.links.filter((e=>e.path!==t.path)),this.newlink=t},fix_newlink_path(){if(this.newlink.path&&this.newlink.path.includes("."))try{this.newlink.path=new URL(this.newlink.path).href}catch(t){this.newlink.path="https://"+this.newlink.path,this.fix_newlink_path()}},async magic_type(){if(!this.type_ready)return;this.loading_type=!0;const t={name:this.task.name,description:this.task.description,date:this.task.date,classes:this.task_classes.map((t=>this.classes.find((e=>e.id==t))?.name))};this.magic.type(JSON.stringify(t)).then((t=>{t?(new G.bF(`Generated task type '${t}'`,1500),this.$status.log("🔗 Generated task type:",t),this.task.type=t):(new G.OO("Couldn't reasonably infer a task type",2e3),this.$status.warn("📃 Couldn't generate task type")),this.loaded_type=!0,this.loading_type=!1})).catch((t=>{new G.PK("Something went wrong generating the task type",t,3e3),this.$status.error("⚠ Failed task type generation:",t),this.loaded_type=!1,this.loading_type=!1}))},async magic_text(){this.path_ready&&!this.newlink.text&&(this.loading_text=!0,this.magic.text(this.newlink.path).then((t=>{t?(new G.bF(`Generated link text '${t}'`,1500),this.$status.log("🔗 Generated link text:",t),this.newlink.text=t):(new G.OO("Couldn't reasonably infer link text",2e3),this.$status.warn("📃 Couldn't generate link text")),this.loaded_text=!0,this.loading_text=!1})).catch((t=>{new G.PK("Couldn't generate link text",t,3e3),this.$status.error("⚠ Failed link text generation:",t),this.loaded_text=!1,this.loading_text=!1})))}},watch:{"$route.params.tasktype"(t){this.task.type=t},"task.type"(t,e){this.$router.replace({...this.$route,params:{...this.$route.params,tasktype:t}}),"note"==t?(this.task.description=this.task.description||this.task.name,this.task.name=""):"note"==e&&this.task.description?.length<=35&&(this.task.name=this.task.description,this.task.description="")},"newlink.path"(t,e){t!=e&&(this.loaded_text=!1)},"newlink.text"(t,e){t!=e&&(this.loaded_text=!1)},"task.name"(t,e){t!==e&&(this.loaded_type=!1)},"task.description"(t,e){t!==e&&(this.loaded_type=!1)},"task.date"(t,e){t!==e&&(this.loaded_type=!1)},task_classes:{deep:!0,handler(t,e){t!=e&&(this.loaded_type=!1)}}}},M=s(89);const Q=(0,M.Z)(H,[["render",K],["__scopeId","data-v-0ba447cc"]]);var Y=Q}}]);
//# sourceMappingURL=457.4b4d2100.js.map